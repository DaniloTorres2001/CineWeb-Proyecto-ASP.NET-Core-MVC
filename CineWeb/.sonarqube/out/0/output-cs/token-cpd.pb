¶
ÉC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\ViewsModels\PeliculasFiltrosVM.cs
	namespace 	
CineWeb
 
. 

ViewModels 
{ 
public 

class 
PeliculasFiltrosVM #
{ 
public		 
string		 
?		 
Q		 
{		 
get		 
;		 
set		  #
;		# $
}		% &
public 
List 
< 
Genero 
> 
Generos #
{$ %
get& )
;) *
set+ .
;. /
}0 1
=2 3
new4 7
(7 8
)8 9
;9 :
public 
List 
< 
Actor 
> 
Actores "
{# $
get% (
;( )
set* -
;- .
}/ 0
=1 2
new3 6
(6 7
)7 8
;8 9
public 
List 
< 
Director 
> 

Directores (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
=7 8
new9 <
(< =
)= >
;> ?
public 
HashSet 
< 
int 
> 

SelGeneros &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
HashSet 
< 
int 
> 

SelActores &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
=5 6
new7 :
(: ;
); <
;< =
public 
HashSet 
< 
int 
> 
SelDirectores )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
=8 9
new: =
(= >
)> ?
;? @
public 
int 
Page 
{ 
get 
; 
set "
;" #
}$ %
=& '
$num( )
;) *
public 
int 
PageSize 
{ 
get !
;! "
set# &
;& '
}( )
=* +
$num, .
;. /
public 
int 
Total 
{ 
get 
; 
set  #
;# $
}% &
public 
int 

TotalPages 
{ 
get  #
;# $
set% (
;( )
}* +
public 
string 
	QueryBase 
{  !
get" %
;% &
set' *
;* +
}, -
=. /
$str0 2
;2 3
} 
} Œ
lC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddDbContext 
< 
AppDbContext *
>* +
(+ ,
options, 3
=>4 6
options		 
.		 
UseSqlServer		 
(		 
builder		  
.		  !
Configuration		! .
.		. /
GetConnectionString		/ B
(		B C
$str		C V
)		V W
)		W X
)		X Y
;		Y Z
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
if 
( 
! 
app 
. 	
Environment	 
. 
IsDevelopment "
(" #
)# $
)$ %
{ 
app 
. 
UseExceptionHandler 
( 
$str )
)) *
;* +
app 
. 
UseHsts 
( 
) 
; 
} 
app 
. 
UseHttpsRedirection 
( 
) 
; 
app 
. 
UseStaticFiles 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app 
. 
UseAuthorization 
( 
) 
; 
app 
. 
MapControllerRoute 
( 
name 
: 	
$str
 
, 
pattern 
: 
$str :
): ;
;; <
app   
.   
Run   
(   
)   	
;  	 
…
yC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\PeliculaActor.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
PeliculaActor 
{ 
public 
int 

PeliculaId 
{ 
get  #
;# $
set% (
;( )
}* +
public 
Pelicula 
? 
Pelicula !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
int 
ActorId 
{ 
get  
;  !
set" %
;% &
}' (
public		 
Actor		 
?		 
Actor		 
{		 
get		 !
;		! "
set		# &
;		& '
}		( )
}

 
} •
tC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\Pelicula.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
Pelicula 
{ 
public		 
int		 
Id		 
{		 
get		 
;		 
set		  
;		  !
}		" #
[ 	
Required	 
] 
public 
string 
Titulo 
{ 
get "
;" #
set$ '
;' (
}) *
public 
string 
? 
Sinopsis 
{  !
get" %
;% &
set' *
;* +
}, -
public 
int 
Duracion 
{ 
get !
;! "
set# &
;& '
}( )
[ 	
Display	 
( 
Name 
= 
$str *
)* +
]+ ,
[ 	
DataType	 
( 
DataType 
. 
Date 
)  
]  !
public 
DateTime 
? 
FechaEstreno %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
string 
? 

ImagenRuta !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
	NotMapped	 
] 
public 
	IFormFile 
? 
ImagenArchivo '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[ 	
Display	 
( 
Name 
= 
$str  
)  !
]! "
public 
int 
GeneroId 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

ForeignKey	 
( 
$str 
) 
]  
[ 	
ValidateNever	 
] 
public 
Genero 
? 
Genero 
{ 
get  #
;# $
set% (
;( )
}* +
[   	
Display  	 
(   
Name   
=   
$str   "
)  " #
]  # $
public!! 
int!! 

DirectorId!! 
{!! 
get!!  #
;!!# $
set!!% (
;!!( )
}!!* +
["" 	

ForeignKey""	 
("" 
$str""  
)""  !
]""! "
[## 	
ValidateNever##	 
]## 
public$$ 
Director$$ 
?$$ 
Director$$ !
{$$" #
get$$$ '
;$$' (
set$$) ,
;$$, -
}$$. /
[&& 	
ValidateNever&&	 
]&& 
public'' 
ICollection'' 
<'' 
PeliculaActor'' (
>''( )
?'') *
Actores''+ 2
{''3 4
get''5 8
;''8 9
set'': =
;''= >
}''? @
}(( 
})) ·
rC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\Genero.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
Genero 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
Nombre

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
string 
? 
Descripcion "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	
ValidateNever	 
] 
public 
ICollection 
< 
Pelicula #
># $
?$ %
	Peliculas& /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
} 
} “
zC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\ErrorViewModel.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
ErrorViewModel 
{ 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
} 
}		 £
tC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\Director.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
Director 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
Nombre

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
string 
? 
Nacionalidad #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
DataType	 
( 
DataType 
. 
Date 
)  
]  !
public 
DateTime 
? 
FechaNacimiento (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
[ 	
ValidateNever	 
] 
public 
ICollection 
< 
Pelicula #
># $
?$ %
	Peliculas& /
{0 1
get2 5
;5 6
set7 :
;: ;
}< =
} 
} ü
qC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Models\Actor.cs
	namespace 	
CineWeb
 
. 
Models 
{ 
public 

class 
Actor 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[		 	
Required			 
]		 
public

 
string

 
Nombre

 
{

 
get

 "
;

" #
set

$ '
;

' (
}

) *
public 
string 
? 
	Biografia  
{! "
get# &
;& '
set( +
;+ ,
}- .
[ 	
DataType	 
( 
DataType 
. 
Date 
)  
]  !
public 
DateTime 
? 
FechaNacimiento (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
[ 	
ValidateNever	 
] 
public 
ICollection 
< 
PeliculaActor (
>( )
?) *
	Peliculas+ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
} 
} ëu
ÜC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Migrations\20251014022815_Inicial.cs
	namespace 	
CineWeb
 
. 

Migrations 
{ 
public		 

partial		 
class		 
Inicial		  
:		! "
	Migration		# ,
{

 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str 
,  
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
type+ /
:/ 0
$str1 6
,6 7
nullable8 @
:@ A
falseB G
)G H
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Nombre 
= 
table "
." #
Column# )
<) *
string* 0
>0 1
(1 2
type2 6
:6 7
$str8 G
,G H
nullableI Q
:Q R
falseS X
)X Y
,Y Z
	Biografia 
= 
table  %
.% &
Column& ,
<, -
string- 3
>3 4
(4 5
type5 9
:9 :
$str; J
,J K
nullableL T
:T U
trueV Z
)Z [
,[ \
FechaNacimiento #
=$ %
table& +
.+ ,
Column, 2
<2 3
DateTime3 ;
>; <
(< =
type= A
:A B
$strC N
,N O
nullableP X
:X Y
trueZ ^
)^ _
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 1
,1 2
x3 4
=>5 7
x8 9
.9 :
Id: <
)< =
;= >
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str "
," #
columns 
: 
table 
=> !
new" %
{   
Id!! 
=!! 
table!! 
.!! 
Column!! %
<!!% &
int!!& )
>!!) *
(!!* +
type!!+ /
:!!/ 0
$str!!1 6
,!!6 7
nullable!!8 @
:!!@ A
false!!B G
)!!G H
."" 

Annotation"" #
(""# $
$str""$ 8
,""8 9
$str"": @
)""@ A
,""A B
Nombre## 
=## 
table## "
.##" #
Column### )
<##) *
string##* 0
>##0 1
(##1 2
type##2 6
:##6 7
$str##8 G
,##G H
nullable##I Q
:##Q R
false##S X
)##X Y
,##Y Z
Nacionalidad$$  
=$$! "
table$$# (
.$$( )
Column$$) /
<$$/ 0
string$$0 6
>$$6 7
($$7 8
type$$8 <
:$$< =
$str$$> M
,$$M N
nullable$$O W
:$$W X
true$$Y ]
)$$] ^
,$$^ _
FechaNacimiento%% #
=%%$ %
table%%& +
.%%+ ,
Column%%, 2
<%%2 3
DateTime%%3 ;
>%%; <
(%%< =
type%%= A
:%%A B
$str%%C N
,%%N O
nullable%%P X
:%%X Y
true%%Z ^
)%%^ _
}&& 
,&& 
constraints'' 
:'' 
table'' "
=>''# %
{(( 
table)) 
.)) 

PrimaryKey)) $
())$ %
$str))% 4
,))4 5
x))6 7
=>))8 :
x)); <
.))< =
Id))= ?
)))? @
;))@ A
}** 
)** 
;** 
migrationBuilder,, 
.,, 
CreateTable,, (
(,,( )
name-- 
:-- 
$str-- 
,--  
columns.. 
:.. 
table.. 
=>.. !
new.." %
{// 
Id00 
=00 
table00 
.00 
Column00 %
<00% &
int00& )
>00) *
(00* +
type00+ /
:00/ 0
$str001 6
,006 7
nullable008 @
:00@ A
false00B G
)00G H
.11 

Annotation11 #
(11# $
$str11$ 8
,118 9
$str11: @
)11@ A
,11A B
Nombre22 
=22 
table22 "
.22" #
Column22# )
<22) *
string22* 0
>220 1
(221 2
type222 6
:226 7
$str228 G
,22G H
nullable22I Q
:22Q R
false22S X
)22X Y
,22Y Z
Descripcion33 
=33  !
table33" '
.33' (
Column33( .
<33. /
string33/ 5
>335 6
(336 7
type337 ;
:33; <
$str33= L
,33L M
nullable33N V
:33V W
true33X \
)33\ ]
}44 
,44 
constraints55 
:55 
table55 "
=>55# %
{66 
table77 
.77 

PrimaryKey77 $
(77$ %
$str77% 1
,771 2
x773 4
=>775 7
x778 9
.779 :
Id77: <
)77< =
;77= >
}88 
)88 
;88 
migrationBuilder:: 
.:: 
CreateTable:: (
(::( )
name;; 
:;; 
$str;; !
,;;! "
columns<< 
:<< 
table<< 
=><< !
new<<" %
{== 
Id>> 
=>> 
table>> 
.>> 
Column>> %
<>>% &
int>>& )
>>>) *
(>>* +
type>>+ /
:>>/ 0
$str>>1 6
,>>6 7
nullable>>8 @
:>>@ A
false>>B G
)>>G H
.?? 

Annotation?? #
(??# $
$str??$ 8
,??8 9
$str??: @
)??@ A
,??A B
Titulo@@ 
=@@ 
table@@ "
.@@" #
Column@@# )
<@@) *
string@@* 0
>@@0 1
(@@1 2
type@@2 6
:@@6 7
$str@@8 G
,@@G H
nullable@@I Q
:@@Q R
false@@S X
)@@X Y
,@@Y Z
SinopsisAA 
=AA 
tableAA $
.AA$ %
ColumnAA% +
<AA+ ,
stringAA, 2
>AA2 3
(AA3 4
typeAA4 8
:AA8 9
$strAA: I
,AAI J
nullableAAK S
:AAS T
trueAAU Y
)AAY Z
,AAZ [
DuracionBB 
=BB 
tableBB $
.BB$ %
ColumnBB% +
<BB+ ,
intBB, /
>BB/ 0
(BB0 1
typeBB1 5
:BB5 6
$strBB7 <
,BB< =
nullableBB> F
:BBF G
falseBBH M
)BBM N
,BBN O
FechaEstrenoCC  
=CC! "
tableCC# (
.CC( )
ColumnCC) /
<CC/ 0
DateTimeCC0 8
>CC8 9
(CC9 :
typeCC: >
:CC> ?
$strCC@ K
,CCK L
nullableCCM U
:CCU V
trueCCW [
)CC[ \
,CC\ ]

ImagenRutaDD 
=DD  
tableDD! &
.DD& '
ColumnDD' -
<DD- .
stringDD. 4
>DD4 5
(DD5 6
typeDD6 :
:DD: ;
$strDD< K
,DDK L
nullableDDM U
:DDU V
trueDDW [
)DD[ \
,DD\ ]
GeneroIdEE 
=EE 
tableEE $
.EE$ %
ColumnEE% +
<EE+ ,
intEE, /
>EE/ 0
(EE0 1
typeEE1 5
:EE5 6
$strEE7 <
,EE< =
nullableEE> F
:EEF G
falseEEH M
)EEM N
,EEN O

DirectorIdFF 
=FF  
tableFF! &
.FF& '
ColumnFF' -
<FF- .
intFF. 1
>FF1 2
(FF2 3
typeFF3 7
:FF7 8
$strFF9 >
,FF> ?
nullableFF@ H
:FFH I
falseFFJ O
)FFO P
}GG 
,GG 
constraintsHH 
:HH 
tableHH "
=>HH# %
{II 
tableJJ 
.JJ 

PrimaryKeyJJ $
(JJ$ %
$strJJ% 3
,JJ3 4
xJJ5 6
=>JJ7 9
xJJ: ;
.JJ; <
IdJJ< >
)JJ> ?
;JJ? @
tableKK 
.KK 

ForeignKeyKK $
(KK$ %
nameLL 
:LL 
$strLL B
,LLB C
columnMM 
:MM 
xMM  !
=>MM" $
xMM% &
.MM& '

DirectorIdMM' 1
,MM1 2
principalTableNN &
:NN& '
$strNN( 4
,NN4 5
principalColumnOO '
:OO' (
$strOO) -
,OO- .
onDeletePP  
:PP  !
ReferentialActionPP" 3
.PP3 4
CascadePP4 ;
)PP; <
;PP< =
tableQQ 
.QQ 

ForeignKeyQQ $
(QQ$ %
nameRR 
:RR 
$strRR =
,RR= >
columnSS 
:SS 
xSS  !
=>SS" $
xSS% &
.SS& '
GeneroIdSS' /
,SS/ 0
principalTableTT &
:TT& '
$strTT( 1
,TT1 2
principalColumnUU '
:UU' (
$strUU) -
,UU- .
onDeleteVV  
:VV  !
ReferentialActionVV" 3
.VV3 4
CascadeVV4 ;
)VV; <
;VV< =
}WW 
)WW 
;WW 
migrationBuilderYY 
.YY 
CreateTableYY (
(YY( )
nameZZ 
:ZZ 
$strZZ (
,ZZ( )
columns[[ 
:[[ 
table[[ 
=>[[ !
new[[" %
{\\ 

PeliculaId]] 
=]]  
table]]! &
.]]& '
Column]]' -
<]]- .
int]]. 1
>]]1 2
(]]2 3
type]]3 7
:]]7 8
$str]]9 >
,]]> ?
nullable]]@ H
:]]H I
false]]J O
)]]O P
,]]P Q
ActorId^^ 
=^^ 
table^^ #
.^^# $
Column^^$ *
<^^* +
int^^+ .
>^^. /
(^^/ 0
type^^0 4
:^^4 5
$str^^6 ;
,^^; <
nullable^^= E
:^^E F
false^^G L
)^^L M
}__ 
,__ 
constraints`` 
:`` 
table`` "
=>``# %
{aa 
tablebb 
.bb 

PrimaryKeybb $
(bb$ %
$strbb% :
,bb: ;
xbb< =
=>bb> @
newbbA D
{bbE F
xbbG H
.bbH I

PeliculaIdbbI S
,bbS T
xbbU V
.bbV W
ActorIdbbW ^
}bb_ `
)bb` a
;bba b
tablecc 
.cc 

ForeignKeycc $
(cc$ %
namedd 
:dd 
$strdd C
,ddC D
columnee 
:ee 
xee  !
=>ee" $
xee% &
.ee& '
ActorIdee' .
,ee. /
principalTableff &
:ff& '
$strff( 1
,ff1 2
principalColumngg '
:gg' (
$strgg) -
,gg- .
onDeletehh  
:hh  !
ReferentialActionhh" 3
.hh3 4
Cascadehh4 ;
)hh; <
;hh< =
tableii 
.ii 

ForeignKeyii $
(ii$ %
namejj 
:jj 
$strjj H
,jjH I
columnkk 
:kk 
xkk  !
=>kk" $
xkk% &
.kk& '

PeliculaIdkk' 1
,kk1 2
principalTablell &
:ll& '
$strll( 3
,ll3 4
principalColumnmm '
:mm' (
$strmm) -
,mm- .
onDeletenn  
:nn  !
ReferentialActionnn" 3
.nn3 4
Cascadenn4 ;
)nn; <
;nn< =
}oo 
)oo 
;oo 
migrationBuilderqq 
.qq 
CreateIndexqq (
(qq( )
namerr 
:rr 
$strrr /
,rr/ 0
tabless 
:ss 
$strss "
,ss" #
columntt 
:tt 
$strtt $
)tt$ %
;tt% &
migrationBuildervv 
.vv 
CreateIndexvv (
(vv( )
nameww 
:ww 
$strww -
,ww- .
tablexx 
:xx 
$strxx "
,xx" #
columnyy 
:yy 
$stryy "
)yy" #
;yy# $
migrationBuilder{{ 
.{{ 
CreateIndex{{ (
({{( )
name|| 
:|| 
$str|| 3
,||3 4
table}} 
:}} 
$str}} )
,}}) *
column~~ 
:~~ 
$str~~ !
)~~! "
;~~" #
} 	
	protected
ÇÇ 
override
ÇÇ 
void
ÇÇ 
Down
ÇÇ  $
(
ÇÇ$ %
MigrationBuilder
ÇÇ% 5
migrationBuilder
ÇÇ6 F
)
ÇÇF G
{
ÉÉ 	
migrationBuilder
ÑÑ 
.
ÑÑ 
	DropTable
ÑÑ &
(
ÑÑ& '
name
ÖÖ 
:
ÖÖ 
$str
ÖÖ (
)
ÖÖ( )
;
ÖÖ) *
migrationBuilder
áá 
.
áá 
	DropTable
áá &
(
áá& '
name
àà 
:
àà 
$str
àà 
)
àà  
;
àà  !
migrationBuilder
ää 
.
ää 
	DropTable
ää &
(
ää& '
name
ãã 
:
ãã 
$str
ãã !
)
ãã! "
;
ãã" #
migrationBuilder
çç 
.
çç 
	DropTable
çç &
(
çç& '
name
éé 
:
éé 
$str
éé "
)
éé" #
;
éé# $
migrationBuilder
êê 
.
êê 
	DropTable
êê &
(
êê& '
name
ëë 
:
ëë 
$str
ëë 
)
ëë  
;
ëë  !
}
íí 	
}
ìì 
}îî ù
vC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Data\AppDbContext.cs
	namespace 	
CineWeb
 
. 
Data 
{ 
public 

class 
AppDbContext 
: 
	DbContext  )
{ 
public 
AppDbContext 
( 
DbContextOptions ,
<, -
AppDbContext- 9
>9 :
options; B
)B C
:D E
baseF J
(J K
optionsK R
)R S
{T U
}V W
public

 
DbSet

 
<

 
Pelicula

 
>

 
	Peliculas

 (
{

) *
get

+ .
;

. /
set

0 3
;

3 4
}

5 6
public 
DbSet 
< 
Genero 
> 
Generos $
{% &
get' *
;* +
set, /
;/ 0
}1 2
public 
DbSet 
< 
Director 
> 

Directores )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
public 
DbSet 
< 
Actor 
> 
Actores #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DbSet 
< 
PeliculaActor "
>" #
PeliculasActores$ 4
{5 6
get7 :
;: ;
set< ?
;? @
}A B
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
base 
. 
OnModelCreating  
(  !
modelBuilder! -
)- .
;. /
modelBuilder 
. 
Entity 
<  
PeliculaActor  -
>- .
(. /
)/ 0
.0 1
HasKey1 7
(7 8
pa8 :
=>; =
new> A
{B C
paD F
.F G

PeliculaIdG Q
,Q R
paS U
.U V
ActorIdV ]
}^ _
)_ `
;` a
} 	
} 
} ˘˝
ÑC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Controllers\PeliculasController.cs
	namespace 	
CineWeb
 
. 
Controllers 
{ 
public 

class 
PeliculasController $
:% &

Controller' 1
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
private 
readonly 
IWebHostEnvironment ,
_env- 1
;1 2
private 
static 
readonly 
string  &
[& '
]' (
_extPermitidas) 7
=8 9
new: =
[= >
]> ?
{@ A
$strB H
,H I
$strJ Q
,Q R
$strS Y
,Y Z
$str[ b
}c d
;d e
private 
static 
readonly 
string  &
[& '
]' (
_mimePermitidos) 8
=9 :
new; >
[> ?
]? @
{A B
$strC O
,O P
$strQ \
,\ ]
$str^ j
}k l
;l m
private 
const 
string 
CarpetaRelativa ,
=- .
$str/ C
;C D
public 
PeliculasController "
(" #
AppDbContext# /
context0 7
,7 8
IWebHostEnvironment9 L
envM P
)P Q
{ 	
_context 
= 
context 
; 
_env 
= 
env 
; 
} 	
public   
async   
Task   
<   
IActionResult   '
>  ' (
Index  ) .
(  . /
string!! 
?!! 
q!! 
,!! 
int"" 
["" 
]"" 
?"" 
generos"" 
,"" 
int## 
[## 
]## 
?## 
actores## 
,## 
int$$ 
[$$ 
]$$ 
?$$ 

directores$$ 
,$$ 
int%% 
page%% 
=%% 
$num%% 
,%% 
int&& 
pageSize&& 
=&& 
$num&& 
)&& 
{'' 	
var(( 
	baseQuery(( 
=(( 
_context(( $
.(($ %
	Peliculas((% .
.)) 
Include)) 
()) 
p)) 
=>)) 
p)) 
.))  
Genero))  &
)))& '
.** 
Include** 
(** 
p** 
=>** 
p** 
.**  
Director**  (
)**( )
.++ 
Include++ 
(++ 
p++ 
=>++ 
p++ 
.++  
Actores++  '
)++' (
.++( )
ThenInclude++) 4
(++4 5
pa++5 7
=>++8 :
pa++; =
.++= >
Actor++> C
)++C D
.,, 
AsQueryable,, 
(,, 
),, 
;,, 
if-- 
(-- 
!-- 

ModelState-- 
.-- 
IsValid-- #
)--# $
{.. 
return// 

BadRequest// !
(//! "

ModelState//" ,
)//, -
;//- .
}00 
if22 
(22 
!22 
string22 
.22 
IsNullOrWhiteSpace22 *
(22* +
q22+ ,
)22, -
)22- .
{33 
var44 
txt44 
=44 
q44 
.44 
Trim44  
(44  !
)44! "
;44" #
	baseQuery55 
=55 
	baseQuery55 %
.55% &
Where55& +
(55+ ,
p55, -
=>55. 0
EF551 3
.553 4
	Functions554 =
.55= >
Like55> B
(55B C
p55C D
.55D E
Titulo55E K
,55K L
$"55M O
$str55O P
{55P Q
txt55Q T
}55T U
$str55U V
"55V W
)55W X
)55X Y
;55Y Z
}66 
if77 
(77 
generos77 
is77 
{77 
Length77 #
:77# $
>77% &
$num77' (
}77) *
)77* +
	baseQuery88 
=88 
	baseQuery88 %
.88% &
Where88& +
(88+ ,
p88, -
=>88. 0
generos881 8
.888 9
Contains889 A
(88A B
p88B C
.88C D
GeneroId88D L
)88L M
)88M N
;88N O
if:: 
(:: 

directores:: 
is:: 
{:: 
Length::  &
:::& '
>::( )
$num::* +
}::, -
)::- .
	baseQuery;; 
=;; 
	baseQuery;; %
.;;% &
Where;;& +
(;;+ ,
p;;, -
=>;;. 0

directores;;1 ;
.;;; <
Contains;;< D
(;;D E
p;;E F
.;;F G

DirectorId;;G Q
);;Q R
);;R S
;;;S T
if== 
(== 
actores== 
is== 
{== 
Length== #
:==# $
>==% &
$num==' (
}==) *
)==* +
	baseQuery>> 
=>> 
	baseQuery>> %
.>>% &
Where>>& +
(>>+ ,
p>>, -
=>>>. 0
p>>1 2
.>>2 3
Actores>>3 :
.>>: ;
Any>>; >
(>>> ?
pa>>? A
=>>>B D
actores>>E L
.>>L M
Contains>>M U
(>>U V
pa>>V X
.>>X Y
ActorId>>Y `
)>>` a
)>>a b
)>>b c
;>>c d
	baseQueryAA 
=AA 
	baseQueryAA !
.AA! "
OrderByAA" )
(AA) *
pAA* +
=>AA, .
pAA/ 0
.AA0 1
TituloAA1 7
)AA7 8
;AA8 9
varDD 
totalDD 
=DD 
awaitDD 
	baseQueryDD '
.DD' (

CountAsyncDD( 2
(DD2 3
)DD3 4
;DD4 5
ifGG 
(GG 
pageSizeGG 
<=GG 
$numGG 
)GG 
pageSizeGG '
=GG( )
$numGG* ,
;GG, -
varHH 

totalPagesHH 
=HH 
MathHH !
.HH! "
MaxHH" %
(HH% &
$numHH& '
,HH' (
(HH) *
intHH* -
)HH- .
MathHH. 2
.HH2 3
CeilingHH3 :
(HH: ;
totalHH; @
/HHA B
(HHC D
doubleHHD J
)HHJ K
pageSizeHHK S
)HHS T
)HHT U
;HHU V
ifII 
(II 
pageII 
<=II 
$numII 
)II 
pageII 
=II  !
$numII" #
;II# $
ifJJ 
(JJ 
pageJJ 
>JJ 

totalPagesJJ !
)JJ! "
pageJJ# '
=JJ( )

totalPagesJJ* 4
;JJ4 5
varMM 
	peliculasMM 
=MM 
awaitMM !
	baseQueryMM" +
.NN 
SkipNN 
(NN 
(NN 
pageNN 
-NN 
$numNN 
)NN  
*NN! "
pageSizeNN# +
)NN+ ,
.OO 
TakeOO 
(OO 
pageSizeOO 
)OO 
.PP 
ToListAsyncPP 
(PP 
)PP 
;PP 
varSS 
	filtrosVMSS 
=SS 
newSS 
PeliculasFiltrosVMSS  2
{TT 
QUU 
=UU 
qUU 
,UU 
GenerosVV 
=VV 
awaitVV 
_contextVV  (
.VV( )
GenerosVV) 0
.VV0 1
OrderByVV1 8
(VV8 9
gVV9 :
=>VV; =
gVV> ?
.VV? @
NombreVV@ F
)VVF G
.VVG H
ToListAsyncVVH S
(VVS T
)VVT U
,VVU V
ActoresWW 
=WW 
awaitWW 
_contextWW  (
.WW( )
ActoresWW) 0
.WW0 1
OrderByWW1 8
(WW8 9
aWW9 :
=>WW; =
aWW> ?
.WW? @
NombreWW@ F
)WWF G
.WWG H
ToListAsyncWWH S
(WWS T
)WWT U
,WWU V

DirectoresXX 
=XX 
awaitXX "
_contextXX# +
.XX+ ,

DirectoresXX, 6
.XX6 7
OrderByXX7 >
(XX> ?
dXX? @
=>XXA C
dXXD E
.XXE F
NombreXXF L
)XXL M
.XXM N
ToListAsyncXXN Y
(XXY Z
)XXZ [
,XX[ \

SelGenerosZZ 
=ZZ 
newZZ  
HashSetZZ! (
<ZZ( )
intZZ) ,
>ZZ, -
(ZZ- .
generosZZ. 5
??ZZ6 8
ArrayZZ9 >
.ZZ> ?
EmptyZZ? D
<ZZD E
intZZE H
>ZZH I
(ZZI J
)ZZJ K
)ZZK L
,ZZL M

SelActores[[ 
=[[ 
new[[  
HashSet[[! (
<[[( )
int[[) ,
>[[, -
([[- .
actores[[. 5
??[[6 8
Array[[9 >
.[[> ?
Empty[[? D
<[[D E
int[[E H
>[[H I
([[I J
)[[J K
)[[K L
,[[L M
SelDirectores\\ 
=\\ 
new\\  #
HashSet\\$ +
<\\+ ,
int\\, /
>\\/ 0
(\\0 1

directores\\1 ;
??\\< >
Array\\? D
.\\D E
Empty\\E J
<\\J K
int\\K N
>\\N O
(\\O P
)\\P Q
)\\Q R
,\\R S
Page^^ 
=^^ 
page^^ 
,^^ 
PageSize__ 
=__ 
pageSize__ #
,__# $
Total`` 
=`` 
total`` 
,`` 

TotalPagesaa 
=aa 

totalPagesaa '
,aa' (
	QueryBasebb 
=bb 
BuildQueryBasebb *
(bb* +
qbb+ ,
,bb, -
generosbb. 5
,bb5 6
actoresbb7 >
,bb> ?

directoresbb@ J
,bbJ K
pageSizebbL T
)bbT U
}cc 
;cc 
ViewBagee 
.ee 
Filtrosee 
=ee 
	filtrosVMee '
;ee' (
ViewDatahh 
[hh 
$strhh "
]hh" #
=hh$ %
pagehh& *
;hh* +
ViewDataii 
[ii 
$strii !
]ii! "
=ii# $

totalPagesii% /
;ii/ 0
ViewDatajj 
[jj 
$strjj $
]jj$ %
=jj& '
qjj( )
??jj* ,
$strjj- /
;jj/ 0
returnll 
Viewll 
(ll 
	peliculasll !
)ll! "
;ll" #
}mm 	
privatepp 
staticpp 
stringpp 
BuildQueryBasepp ,
(pp, -
stringpp- 3
?pp3 4
qpp5 6
,pp6 7
intpp8 ;
[pp; <
]pp< =
?pp= >
generospp? F
,ppF G
intppH K
[ppK L
]ppL M
?ppM N
actoresppO V
,ppV W
intppX [
[pp[ \
]pp\ ]
?pp] ^

directorespp_ i
,ppi j
intppk n
pageSizeppo w
)ppw x
{qq 	
varrr 
sbrr 
=rr 
newrr 
StringBuilderrr &
(rr& '
)rr' (
;rr( )
voidtt 
Appendtt 
(tt 
stringtt 
keytt "
,tt" #
stringtt$ *
?tt* +
valuett, 1
)tt1 2
{uu 
ifvv 
(vv 
stringvv 
.vv 
IsNullOrWhiteSpacevv -
(vv- .
valuevv. 3
)vv3 4
)vv4 5
returnvv6 <
;vv< =
ifww 
(ww 
sbww 
.ww 
Lengthww 
>ww 
$numww  !
)ww! "
sbww# %
.ww% &
Appendww& ,
(ww, -
$charww- 0
)ww0 1
;ww1 2
sbxx 
.xx 
Appendxx 
(xx 
keyxx 
)xx 
.xx 
Appendxx %
(xx% &
$charxx& )
)xx) *
.xx* +
Appendxx+ 1
(xx1 2
Urixx2 5
.xx5 6
EscapeDataStringxx6 F
(xxF G
valuexxG L
)xxL M
)xxM N
;xxN O
}yy 
voidzz 
	AppendArrzz 
(zz 
stringzz !
keyzz" %
,zz% &
intzz' *
[zz* +
]zz+ ,
?zz, -
arrzz. 1
)zz1 2
{{{ 
if|| 
(|| 
arr|| 
is|| 
not|| 
{||  
Length||! '
:||' (
>||) *
$num||+ ,
}||- .
)||. /
return||0 6
;||6 7
foreach}} 
(}} 
var}} 
v}} 
in}} !
arr}}" %
)}}% &
{~~ 
if 
( 
sb 
. 
Length !
>" #
$num$ %
)% &
sb' )
.) *
Append* 0
(0 1
$char1 4
)4 5
;5 6
sb
ÄÄ 
.
ÄÄ 
Append
ÄÄ 
(
ÄÄ 
key
ÄÄ !
)
ÄÄ! "
.
ÄÄ" #
Append
ÄÄ# )
(
ÄÄ) *
$char
ÄÄ* -
)
ÄÄ- .
.
ÄÄ. /
Append
ÄÄ/ 5
(
ÄÄ5 6
v
ÄÄ6 7
)
ÄÄ7 8
;
ÄÄ8 9
}
ÅÅ 
}
ÇÇ 
Append
ÑÑ 
(
ÑÑ 
$str
ÑÑ 
,
ÑÑ 
q
ÑÑ 
?
ÑÑ 
.
ÑÑ 
Trim
ÑÑ 
(
ÑÑ  
)
ÑÑ  !
)
ÑÑ! "
;
ÑÑ" #
	AppendArr
ÖÖ 
(
ÖÖ 
$str
ÖÖ 
,
ÖÖ  
generos
ÖÖ! (
)
ÖÖ( )
;
ÖÖ) *
	AppendArr
ÜÜ 
(
ÜÜ 
$str
ÜÜ 
,
ÜÜ  
actores
ÜÜ! (
)
ÜÜ( )
;
ÜÜ) *
	AppendArr
áá 
(
áá 
$str
áá "
,
áá" #

directores
áá$ .
)
áá. /
;
áá/ 0
Append
àà 
(
àà 
$str
àà 
,
àà 
pageSize
àà '
.
àà' (
ToString
àà( 0
(
àà0 1
)
àà1 2
)
àà2 3
;
àà3 4
return
ää 
sb
ää 
.
ää 
ToString
ää 
(
ää 
)
ää  
;
ää  !
}
ãã 	
private
éé 
static
éé 
string
éé 
BuildQueryBase
éé ,
(
éé, -
string
éé- 3
?
éé3 4
q
éé5 6
,
éé6 7
int
éé8 ;
[
éé; <
]
éé< =
?
éé= >
generos
éé? F
,
ééF G
int
ééH K
[
ééK L
]
ééL M
?
ééM N
actores
ééO V
,
ééV W
int
ééX [
[
éé[ \
]
éé\ ]
?
éé] ^

directores
éé_ i
,
ééi j
string
éék q
sort
éér v
,
éév w
int
ééx {
pageSizeéé| Ñ
)ééÑ Ö
{
èè 	
var
êê 
sb
êê 
=
êê 
new
êê 
StringBuilder
êê &
(
êê& '
)
êê' (
;
êê( )
void
íí 
Append
íí 
(
íí 
string
íí 
key
íí "
,
íí" #
string
íí$ *
?
íí* +
value
íí, 1
)
íí1 2
{
ìì 
if
îî 
(
îî 
string
îî 
.
îî  
IsNullOrWhiteSpace
îî -
(
îî- .
value
îî. 3
)
îî3 4
)
îî4 5
return
îî6 <
;
îî< =
if
ïï 
(
ïï 
sb
ïï 
.
ïï 
Length
ïï 
>
ïï 
$num
ïï  !
)
ïï! "
sb
ïï# %
.
ïï% &
Append
ïï& ,
(
ïï, -
$char
ïï- 0
)
ïï0 1
;
ïï1 2
sb
ññ 
.
ññ 
Append
ññ 
(
ññ 
key
ññ 
)
ññ 
.
ññ 
Append
ññ %
(
ññ% &
$char
ññ& )
)
ññ) *
.
ññ* +
Append
ññ+ 1
(
ññ1 2
Uri
ññ2 5
.
ññ5 6
EscapeDataString
ññ6 F
(
ññF G
value
ññG L
)
ññL M
)
ññM N
;
ññN O
}
óó 
void
òò 
	AppendArr
òò 
(
òò 
string
òò !
key
òò" %
,
òò% &
int
òò' *
[
òò* +
]
òò+ ,
?
òò, -
arr
òò. 1
)
òò1 2
{
ôô 
if
öö 
(
öö 
arr
öö 
is
öö 
not
öö 
{
öö  
Length
öö! '
:
öö' (
>
öö) *
$num
öö+ ,
}
öö- .
)
öö. /
return
öö0 6
;
öö6 7
foreach
õõ 
(
õõ 
var
õõ 
v
õõ 
in
õõ !
arr
õõ" %
)
õõ% &
{
úú 
if
ùù 
(
ùù 
sb
ùù 
.
ùù 
Length
ùù !
>
ùù" #
$num
ùù$ %
)
ùù% &
sb
ùù' )
.
ùù) *
Append
ùù* 0
(
ùù0 1
$char
ùù1 4
)
ùù4 5
;
ùù5 6
sb
ûû 
.
ûû 
Append
ûû 
(
ûû 
key
ûû !
)
ûû! "
.
ûû" #
Append
ûû# )
(
ûû) *
$char
ûû* -
)
ûû- .
.
ûû. /
Append
ûû/ 5
(
ûû5 6
v
ûû6 7
)
ûû7 8
;
ûû8 9
}
üü 
}
†† 
Append
¢¢ 
(
¢¢ 
$str
¢¢ 
,
¢¢ 
q
¢¢ 
?
¢¢ 
.
¢¢ 
Trim
¢¢ 
(
¢¢  
)
¢¢  !
)
¢¢! "
;
¢¢" #
	AppendArr
££ 
(
££ 
$str
££ 
,
££  
generos
££! (
)
££( )
;
££) *
	AppendArr
§§ 
(
§§ 
$str
§§ 
,
§§  
actores
§§! (
)
§§( )
;
§§) *
	AppendArr
•• 
(
•• 
$str
•• "
,
••" #

directores
••$ .
)
••. /
;
••/ 0
Append
¶¶ 
(
¶¶ 
$str
¶¶ 
,
¶¶ 
string
¶¶ !
.
¶¶! " 
IsNullOrWhiteSpace
¶¶" 4
(
¶¶4 5
sort
¶¶5 9
)
¶¶9 :
?
¶¶; <
$str
¶¶= I
:
¶¶J K
sort
¶¶L P
)
¶¶P Q
;
¶¶Q R
Append
ßß 
(
ßß 
$str
ßß 
,
ßß 
pageSize
ßß '
.
ßß' (
ToString
ßß( 0
(
ßß0 1
)
ßß1 2
)
ßß2 3
;
ßß3 4
return
©© 
sb
©© 
.
©© 
ToString
©© 
(
©© 
)
©©  
;
©©  !
}
™™ 	
public
ØØ 
async
ØØ 
Task
ØØ 
<
ØØ 
IActionResult
ØØ '
>
ØØ' (
Details
ØØ) 0
(
ØØ0 1
int
ØØ1 4
?
ØØ4 5
id
ØØ6 8
)
ØØ8 9
{
∞∞ 	
if
±± 
(
±± 
!
±± 

ModelState
±± 
.
±± 
IsValid
±± #
)
±±# $
{
≤≤ 
return
≥≥ 

BadRequest
≥≥ !
(
≥≥! "

ModelState
≥≥" ,
)
≥≥, -
;
≥≥- .
}
¥¥ 
if
µµ 
(
µµ 
id
µµ 
==
µµ 
null
µµ 
)
µµ 
return
µµ "
NotFound
µµ# +
(
µµ+ ,
)
µµ, -
;
µµ- .
var
∑∑ 
pelicula
∑∑ 
=
∑∑ 
await
∑∑  
_context
∑∑! )
.
∑∑) *
	Peliculas
∑∑* 3
.
∏∏ 
Include
∏∏ 
(
∏∏ 
p
∏∏ 
=>
∏∏ 
p
∏∏ 
.
∏∏  
Genero
∏∏  &
)
∏∏& '
.
ππ 
Include
ππ 
(
ππ 
p
ππ 
=>
ππ 
p
ππ 
.
ππ  
Director
ππ  (
)
ππ( )
.
∫∫ 
Include
∫∫ 
(
∫∫ 
p
∫∫ 
=>
∫∫ 
p
∫∫ 
.
∫∫  
Actores
∫∫  '
)
∫∫' (
.
∫∫( )
ThenInclude
∫∫) 4
(
∫∫4 5
pa
∫∫5 7
=>
∫∫8 :
pa
∫∫; =
.
∫∫= >
Actor
∫∫> C
)
∫∫C D
.
ªª !
FirstOrDefaultAsync
ªª $
(
ªª$ %
m
ªª% &
=>
ªª' )
m
ªª* +
.
ªª+ ,
Id
ªª, .
==
ªª/ 1
id
ªª2 4
)
ªª4 5
;
ªª5 6
if
ΩΩ 
(
ΩΩ 
pelicula
ΩΩ 
==
ΩΩ 
null
ΩΩ  
)
ΩΩ  !
return
ΩΩ" (
NotFound
ΩΩ) 1
(
ΩΩ1 2
)
ΩΩ2 3
;
ΩΩ3 4
return
øø 
View
øø 
(
øø 
pelicula
øø  
)
øø  !
;
øø! "
}
¿¿ 	
public
√√ 
IActionResult
√√ 
Create
√√ #
(
√√# $
)
√√$ %
{
ƒƒ 	
CargarCombos
≈≈ 
(
≈≈ 
)
≈≈ 
;
≈≈ 
return
∆∆ 
View
∆∆ 
(
∆∆ 
)
∆∆ 
;
∆∆ 
}
«« 	
[
   	
HttpPost
  	 
]
   
[
ÀÀ 	&
ValidateAntiForgeryToken
ÀÀ	 !
]
ÀÀ! "
public
ÃÃ 
async
ÃÃ 
Task
ÃÃ 
<
ÃÃ 
IActionResult
ÃÃ '
>
ÃÃ' (
Create
ÃÃ) /
(
ÃÃ/ 0
Pelicula
ÃÃ0 8
pelicula
ÃÃ9 A
,
ÃÃA B
int
ÃÃC F
[
ÃÃF G
]
ÃÃG H
actorIds
ÃÃI Q
)
ÃÃQ R
{
ÕÕ 	
if
ŒŒ 
(
ŒŒ 
!
ŒŒ 

ModelState
ŒŒ 
.
ŒŒ 
IsValid
ŒŒ #
)
ŒŒ# $
{
œœ 
CargarCombos
–– 
(
–– 
pelicula
–– %
.
––% &
GeneroId
––& .
,
––. /
pelicula
––0 8
.
––8 9

DirectorId
––9 C
,
––C D
actorIds
––E M
)
––M N
;
––N O
return
—— 
View
—— 
(
—— 
pelicula
—— $
)
——$ %
;
——% &
}
““ 
if
’’ 
(
’’ 
pelicula
’’ 
.
’’ 
ImagenArchivo
’’ &
!=
’’' )
null
’’* .
&&
’’/ 1
pelicula
’’2 :
.
’’: ;
ImagenArchivo
’’; H
.
’’H I
Length
’’I O
>
’’P Q
$num
’’R S
)
’’S T
{
÷÷ 
var
◊◊ 
(
◊◊ 
ok
◊◊ 
,
◊◊ 
rutaRel
◊◊  
,
◊◊  !
error
◊◊" '
)
◊◊' (
=
◊◊) *
await
◊◊+ 0
SaveImageAsync
◊◊1 ?
(
◊◊? @
pelicula
◊◊@ H
.
◊◊H I
ImagenArchivo
◊◊I V
)
◊◊V W
;
◊◊W X
if
ÿÿ 
(
ÿÿ 
!
ÿÿ 
ok
ÿÿ 
)
ÿÿ 
{
ŸŸ 

ModelState
⁄⁄ 
.
⁄⁄ 
AddModelError
⁄⁄ ,
(
⁄⁄, -
nameof
⁄⁄- 3
(
⁄⁄3 4
pelicula
⁄⁄4 <
.
⁄⁄< =
ImagenArchivo
⁄⁄= J
)
⁄⁄J K
,
⁄⁄K L
error
⁄⁄M R
??
⁄⁄S U
$str
⁄⁄V h
)
⁄⁄h i
;
⁄⁄i j
CargarCombos
€€  
(
€€  !
pelicula
€€! )
.
€€) *
GeneroId
€€* 2
,
€€2 3
pelicula
€€4 <
.
€€< =

DirectorId
€€= G
,
€€G H
actorIds
€€I Q
)
€€Q R
;
€€R S
return
‹‹ 
View
‹‹ 
(
‹‹  
pelicula
‹‹  (
)
‹‹( )
;
‹‹) *
}
›› 
pelicula
ﬁﬁ 
.
ﬁﬁ 

ImagenRuta
ﬁﬁ #
=
ﬁﬁ$ %
$str
ﬁﬁ& )
+
ﬁﬁ* +
rutaRel
ﬁﬁ, 3
.
ﬁﬁ3 4
Replace
ﬁﬁ4 ;
(
ﬁﬁ; <
$str
ﬁﬁ< @
,
ﬁﬁ@ A
$str
ﬁﬁB E
)
ﬁﬁE F
;
ﬁﬁF G
}
ﬂﬂ 
_context
·· 
.
·· 
Add
·· 
(
·· 
pelicula
·· !
)
··! "
;
··" #
await
‚‚ 
_context
‚‚ 
.
‚‚ 
SaveChangesAsync
‚‚ +
(
‚‚+ ,
)
‚‚, -
;
‚‚- .
if
ÂÂ 
(
ÂÂ 
actorIds
ÂÂ 
!=
ÂÂ 
null
ÂÂ  
&&
ÂÂ! #
actorIds
ÂÂ$ ,
.
ÂÂ, -
Length
ÂÂ- 3
>
ÂÂ4 5
$num
ÂÂ6 7
)
ÂÂ7 8
{
ÊÊ 
foreach
ÁÁ 
(
ÁÁ 
var
ÁÁ 
aid
ÁÁ  
in
ÁÁ! #
actorIds
ÁÁ$ ,
)
ÁÁ, -
_context
ËË 
.
ËË 
PeliculasActores
ËË -
.
ËË- .
Add
ËË. 1
(
ËË1 2
new
ËË2 5
PeliculaActor
ËË6 C
{
ËËD E

PeliculaId
ËËF P
=
ËËQ R
pelicula
ËËS [
.
ËË[ \
Id
ËË\ ^
,
ËË^ _
ActorId
ËË` g
=
ËËh i
aid
ËËj m
}
ËËn o
)
ËËo p
;
ËËp q
await
ÈÈ 
_context
ÈÈ 
.
ÈÈ 
SaveChangesAsync
ÈÈ /
(
ÈÈ/ 0
)
ÈÈ0 1
;
ÈÈ1 2
}
ÍÍ 
return
ÏÏ 
RedirectToAction
ÏÏ #
(
ÏÏ# $
nameof
ÏÏ$ *
(
ÏÏ* +
Index
ÏÏ+ 0
)
ÏÏ0 1
)
ÏÏ1 2
;
ÏÏ2 3
}
ÌÌ 	
public
 
async
 
Task
 
<
 
IActionResult
 '
>
' (
Edit
) -
(
- .
int
. 1
?
1 2
id
3 5
)
5 6
{
ÒÒ 	
if
ÚÚ 
(
ÚÚ 
!
ÚÚ 

ModelState
ÚÚ 
.
ÚÚ 
IsValid
ÚÚ #
)
ÚÚ# $
{
ÛÛ 
return
ÙÙ 

BadRequest
ÙÙ !
(
ÙÙ! "

ModelState
ÙÙ" ,
)
ÙÙ, -
;
ÙÙ- .
}
ıı 
if
ˆˆ 
(
ˆˆ 
id
ˆˆ 
==
ˆˆ 
null
ˆˆ 
)
ˆˆ 
return
ˆˆ "
NotFound
ˆˆ# +
(
ˆˆ+ ,
)
ˆˆ, -
;
ˆˆ- .
var
¯¯ 
pelicula
¯¯ 
=
¯¯ 
await
¯¯  
_context
¯¯! )
.
¯¯) *
	Peliculas
¯¯* 3
.
˘˘ 
Include
˘˘ 
(
˘˘ 
p
˘˘ 
=>
˘˘ 
p
˘˘ 
.
˘˘  
Actores
˘˘  '
)
˘˘' (
.
˙˙ !
FirstOrDefaultAsync
˙˙ $
(
˙˙$ %
p
˙˙% &
=>
˙˙' )
p
˙˙* +
.
˙˙+ ,
Id
˙˙, .
==
˙˙/ 1
id
˙˙2 4
)
˙˙4 5
;
˙˙5 6
if
¸¸ 
(
¸¸ 
pelicula
¸¸ 
==
¸¸ 
null
¸¸  
)
¸¸  !
return
¸¸" (
NotFound
¸¸) 1
(
¸¸1 2
)
¸¸2 3
;
¸¸3 4
var
˛˛ 
seleccionados
˛˛ 
=
˛˛ 
pelicula
˛˛  (
.
˛˛( )
Actores
˛˛) 0
?
˛˛0 1
.
˛˛1 2
Select
˛˛2 8
(
˛˛8 9
a
˛˛9 :
=>
˛˛; =
a
˛˛> ?
.
˛˛? @
ActorId
˛˛@ G
)
˛˛G H
.
˛˛H I
ToArray
˛˛I P
(
˛˛P Q
)
˛˛Q R
??
˛˛S U
Array
˛˛V [
.
˛˛[ \
Empty
˛˛\ a
<
˛˛a b
int
˛˛b e
>
˛˛e f
(
˛˛f g
)
˛˛g h
;
˛˛h i
CargarCombos
ˇˇ 
(
ˇˇ 
pelicula
ˇˇ !
.
ˇˇ! "
GeneroId
ˇˇ" *
,
ˇˇ* +
pelicula
ˇˇ, 4
.
ˇˇ4 5

DirectorId
ˇˇ5 ?
,
ˇˇ? @
seleccionados
ˇˇA N
)
ˇˇN O
;
ˇˇO P
return
ÅÅ 
View
ÅÅ 
(
ÅÅ 
pelicula
ÅÅ  
)
ÅÅ  !
;
ÅÅ! "
}
ÇÇ 	
[
ÖÖ 	
HttpPost
ÖÖ	 
]
ÖÖ 
[
ÜÜ 	&
ValidateAntiForgeryToken
ÜÜ	 !
]
ÜÜ! "
public
áá 
async
áá 
Task
áá 
<
áá 
IActionResult
áá '
>
áá' (
Edit
áá) -
(
áá- .
int
áá. 1
id
áá2 4
,
áá4 5
Pelicula
áá6 >
pelicula
áá? G
,
ááG H
int
ááI L
[
ááL M
]
ááM N
actorIds
ááO W
)
ááW X
{
àà 	
if
ââ 
(
ââ 
id
ââ 
!=
ââ 
pelicula
ââ 
.
ââ 
Id
ââ !
)
ââ! "
return
ââ# )
NotFound
ââ* 2
(
ââ2 3
)
ââ3 4
;
ââ4 5
var
ãã 

peliculaDB
ãã 
=
ãã 
await
ãã "
_context
ãã# +
.
ãã+ ,
	Peliculas
ãã, 5
.
ãã5 6
AsNoTracking
ãã6 B
(
ããB C
)
ããC D
.
ããD E!
FirstOrDefaultAsync
ããE X
(
ããX Y
p
ããY Z
=>
ãã[ ]
p
ãã^ _
.
ãã_ `
Id
ãã` b
==
ããc e
id
ããf h
)
ããh i
;
ããi j
if
åå 
(
åå 

peliculaDB
åå 
==
åå 
null
åå "
)
åå" #
return
åå$ *
NotFound
åå+ 3
(
åå3 4
)
åå4 5
;
åå5 6
if
éé 
(
éé 
!
éé 

ModelState
éé 
.
éé 
IsValid
éé #
)
éé# $
{
èè 
CargarCombos
êê 
(
êê 
pelicula
êê %
.
êê% &
GeneroId
êê& .
,
êê. /
pelicula
êê0 8
.
êê8 9

DirectorId
êê9 C
,
êêC D
actorIds
êêE M
)
êêM N
;
êêN O
return
ëë 
View
ëë 
(
ëë 
pelicula
ëë $
)
ëë$ %
;
ëë% &
}
íí 
try
îî 
{
ïï 
if
óó 
(
óó 
pelicula
óó 
.
óó 
ImagenArchivo
óó *
!=
óó+ -
null
óó. 2
&&
óó3 5
pelicula
óó6 >
.
óó> ?
ImagenArchivo
óó? L
.
óóL M
Length
óóM S
>
óóT U
$num
óóV W
)
óóW X
{
òò 
var
ôô 
(
ôô 
ok
ôô 
,
ôô 
rutaRel
ôô $
,
ôô$ %
error
ôô& +
)
ôô+ ,
=
ôô- .
await
ôô/ 4
SaveImageAsync
ôô5 C
(
ôôC D
pelicula
ôôD L
.
ôôL M
ImagenArchivo
ôôM Z
)
ôôZ [
;
ôô[ \
if
öö 
(
öö 
!
öö 
ok
öö 
)
öö 
{
õõ 

ModelState
úú "
.
úú" #
AddModelError
úú# 0
(
úú0 1
nameof
úú1 7
(
úú7 8
pelicula
úú8 @
.
úú@ A
ImagenArchivo
úúA N
)
úúN O
,
úúO P
error
úúQ V
??
úúW Y
$str
úúZ l
)
úúl m
;
úúm n
CargarCombos
ùù $
(
ùù$ %
pelicula
ùù% -
.
ùù- .
GeneroId
ùù. 6
,
ùù6 7
pelicula
ùù8 @
.
ùù@ A

DirectorId
ùùA K
,
ùùK L
actorIds
ùùM U
)
ùùU V
;
ùùV W
return
ûû 
View
ûû #
(
ûû# $
pelicula
ûû$ ,
)
ûû, -
;
ûû- .
}
üü 
if
¢¢ 
(
¢¢ 
!
¢¢ 
string
¢¢ 
.
¢¢  
IsNullOrEmpty
¢¢  -
(
¢¢- .

peliculaDB
¢¢. 8
.
¢¢8 9

ImagenRuta
¢¢9 C
)
¢¢C D
)
¢¢D E!
DeleteImageIfExists
££ +
(
££+ ,

peliculaDB
££, 6
.
££6 7

ImagenRuta
££7 A
)
££A B
;
££B C
pelicula
•• 
.
•• 

ImagenRuta
•• '
=
••( )
$str
••* -
+
••. /
rutaRel
••0 7
.
••7 8
Replace
••8 ?
(
••? @
$str
••@ D
,
••D E
$str
••F I
)
••I J
;
••J K
}
¶¶ 
else
ßß 
{
®® 
pelicula
™™ 
.
™™ 

ImagenRuta
™™ '
=
™™( )

peliculaDB
™™* 4
.
™™4 5

ImagenRuta
™™5 ?
;
™™? @
}
´´ 
_context
≠≠ 
.
≠≠ 
Update
≠≠ 
(
≠≠  
pelicula
≠≠  (
)
≠≠( )
;
≠≠) *
await
ÆÆ 
_context
ÆÆ 
.
ÆÆ 
SaveChangesAsync
ÆÆ /
(
ÆÆ/ 0
)
ÆÆ0 1
;
ÆÆ1 2
var
±± 
actuales
±± 
=
±± 
_context
±± '
.
±±' (
PeliculasActores
±±( 8
.
±±8 9
Where
±±9 >
(
±±> ?
pa
±±? A
=>
±±B D
pa
±±E G
.
±±G H

PeliculaId
±±H R
==
±±S U
id
±±V X
)
±±X Y
;
±±Y Z
_context
≤≤ 
.
≤≤ 
PeliculasActores
≤≤ )
.
≤≤) *
RemoveRange
≤≤* 5
(
≤≤5 6
actuales
≤≤6 >
)
≤≤> ?
;
≤≤? @
if
¥¥ 
(
¥¥ 
actorIds
¥¥ 
!=
¥¥ 
null
¥¥  $
&&
¥¥% '
actorIds
¥¥( 0
.
¥¥0 1
Length
¥¥1 7
>
¥¥8 9
$num
¥¥: ;
)
¥¥; <
{
µµ 
foreach
∂∂ 
(
∂∂ 
var
∂∂  
aid
∂∂! $
in
∂∂% '
actorIds
∂∂( 0
)
∂∂0 1
_context
∑∑  
.
∑∑  !
PeliculasActores
∑∑! 1
.
∑∑1 2
Add
∑∑2 5
(
∑∑5 6
new
∑∑6 9
PeliculaActor
∑∑: G
{
∑∑H I

PeliculaId
∑∑J T
=
∑∑U V
id
∑∑W Y
,
∑∑Y Z
ActorId
∑∑[ b
=
∑∑c d
aid
∑∑e h
}
∑∑i j
)
∑∑j k
;
∑∑k l
}
∏∏ 
await
∫∫ 
_context
∫∫ 
.
∫∫ 
SaveChangesAsync
∫∫ /
(
∫∫/ 0
)
∫∫0 1
;
∫∫1 2
}
ªª 
catch
ºº 
(
ºº *
DbUpdateConcurrencyException
ºº /
)
ºº/ 0
{
ΩΩ 
if
ææ 
(
ææ 
!
ææ 
PeliculaExists
ææ #
(
ææ# $
pelicula
ææ$ ,
.
ææ, -
Id
ææ- /
)
ææ/ 0
)
ææ0 1
return
ææ2 8
NotFound
ææ9 A
(
ææA B
)
ææB C
;
ææC D
throw
øø 
;
øø 
}
¿¿ 
return
¬¬ 
RedirectToAction
¬¬ #
(
¬¬# $
nameof
¬¬$ *
(
¬¬* +
Index
¬¬+ 0
)
¬¬0 1
)
¬¬1 2
;
¬¬2 3
}
√√ 	
public
∆∆ 
async
∆∆ 
Task
∆∆ 
<
∆∆ 
IActionResult
∆∆ '
>
∆∆' (
Delete
∆∆) /
(
∆∆/ 0
int
∆∆0 3
?
∆∆3 4
id
∆∆5 7
)
∆∆7 8
{
«« 	
if
»» 
(
»» 
!
»» 

ModelState
»» 
.
»» 
IsValid
»» #
)
»»# $
{
…… 
return
   

BadRequest
   !
(
  ! "

ModelState
  " ,
)
  , -
;
  - .
}
ÀÀ 
if
ÃÃ 
(
ÃÃ 
id
ÃÃ 
==
ÃÃ 
null
ÃÃ 
)
ÃÃ 
return
ÃÃ "
NotFound
ÃÃ# +
(
ÃÃ+ ,
)
ÃÃ, -
;
ÃÃ- .
var
ŒŒ 
pelicula
ŒŒ 
=
ŒŒ 
await
ŒŒ  
_context
ŒŒ! )
.
ŒŒ) *
	Peliculas
ŒŒ* 3
.
œœ 
Include
œœ 
(
œœ 
p
œœ 
=>
œœ 
p
œœ 
.
œœ  
Genero
œœ  &
)
œœ& '
.
–– 
Include
–– 
(
–– 
p
–– 
=>
–– 
p
–– 
.
––  
Director
––  (
)
––( )
.
—— !
FirstOrDefaultAsync
—— $
(
——$ %
m
——% &
=>
——' )
m
——* +
.
——+ ,
Id
——, .
==
——/ 1
id
——2 4
)
——4 5
;
——5 6
if
”” 
(
”” 
pelicula
”” 
==
”” 
null
””  
)
””  !
return
””" (
NotFound
””) 1
(
””1 2
)
””2 3
;
””3 4
return
’’ 
View
’’ 
(
’’ 
pelicula
’’  
)
’’  !
;
’’! "
}
÷÷ 	
[
ŸŸ 	
HttpPost
ŸŸ	 
,
ŸŸ 

ActionName
ŸŸ 
(
ŸŸ 
$str
ŸŸ &
)
ŸŸ& '
]
ŸŸ' (
[
⁄⁄ 	&
ValidateAntiForgeryToken
⁄⁄	 !
]
⁄⁄! "
public
€€ 
async
€€ 
Task
€€ 
<
€€ 
IActionResult
€€ '
>
€€' (
DeleteConfirmed
€€) 8
(
€€8 9
int
€€9 <
id
€€= ?
)
€€? @
{
‹‹ 	
if
›› 
(
›› 
!
›› 

ModelState
›› 
.
›› 
IsValid
›› #
)
››# $
{
ﬁﬁ 
return
ﬂﬂ 

BadRequest
ﬂﬂ !
(
ﬂﬂ! "

ModelState
ﬂﬂ" ,
)
ﬂﬂ, -
;
ﬂﬂ- .
}
‡‡ 
var
·· 
pelicula
·· 
=
·· 
await
··  
_context
··! )
.
··) *
	Peliculas
··* 3
.
··3 4
	FindAsync
··4 =
(
··= >
id
··> @
)
··@ A
;
··A B
if
‚‚ 
(
‚‚ 
pelicula
‚‚ 
!=
‚‚ 
null
‚‚  
)
‚‚  !
{
„„ 
var
ÂÂ 
enlaces
ÂÂ 
=
ÂÂ 
_context
ÂÂ &
.
ÂÂ& '
PeliculasActores
ÂÂ' 7
.
ÂÂ7 8
Where
ÂÂ8 =
(
ÂÂ= >
pa
ÂÂ> @
=>
ÂÂA C
pa
ÂÂD F
.
ÂÂF G

PeliculaId
ÂÂG Q
==
ÂÂR T
id
ÂÂU W
)
ÂÂW X
;
ÂÂX Y
_context
ÊÊ 
.
ÊÊ 
PeliculasActores
ÊÊ )
.
ÊÊ) *
RemoveRange
ÊÊ* 5
(
ÊÊ5 6
enlaces
ÊÊ6 =
)
ÊÊ= >
;
ÊÊ> ?
if
ÈÈ 
(
ÈÈ 
!
ÈÈ 
string
ÈÈ 
.
ÈÈ 
IsNullOrEmpty
ÈÈ )
(
ÈÈ) *
pelicula
ÈÈ* 2
.
ÈÈ2 3

ImagenRuta
ÈÈ3 =
)
ÈÈ= >
)
ÈÈ> ?!
DeleteImageIfExists
ÍÍ '
(
ÍÍ' (
pelicula
ÍÍ( 0
.
ÍÍ0 1

ImagenRuta
ÍÍ1 ;
)
ÍÍ; <
;
ÍÍ< =
_context
ÏÏ 
.
ÏÏ 
	Peliculas
ÏÏ "
.
ÏÏ" #
Remove
ÏÏ# )
(
ÏÏ) *
pelicula
ÏÏ* 2
)
ÏÏ2 3
;
ÏÏ3 4
await
ÌÌ 
_context
ÌÌ 
.
ÌÌ 
SaveChangesAsync
ÌÌ /
(
ÌÌ/ 0
)
ÌÌ0 1
;
ÌÌ1 2
}
ÓÓ 
return
 
RedirectToAction
 #
(
# $
nameof
$ *
(
* +
Index
+ 0
)
0 1
)
1 2
;
2 3
}
ÒÒ 	
private
ıı 
void
ıı 
CargarCombos
ıı !
(
ıı! "
int
ıı" %
?
ıı% &
generoId
ıı' /
=
ıı0 1
null
ıı2 6
,
ıı6 7
int
ıı8 ;
?
ıı; <

directorId
ıı= G
=
ııH I
null
ııJ N
,
ııN O
int
ııP S
[
ııS T
]
ııT U
?
ııU V
actorIds
ııW _
=
ıı` a
null
ııb f
)
ııf g
{
ˆˆ 	
ViewData
˜˜ 
[
˜˜ 
$str
˜˜ 
]
˜˜  
=
˜˜! "
new
˜˜# &

SelectList
˜˜' 1
(
˜˜1 2
_context
˜˜2 :
.
˜˜: ;
Generos
˜˜; B
,
˜˜B C
$str
˜˜D H
,
˜˜H I
$str
˜˜J R
,
˜˜R S
generoId
˜˜T \
)
˜˜\ ]
;
˜˜] ^
ViewData
¯¯ 
[
¯¯ 
$str
¯¯ !
]
¯¯! "
=
¯¯# $
new
¯¯% (

SelectList
¯¯) 3
(
¯¯3 4
_context
¯¯4 <
.
¯¯< =

Directores
¯¯= G
,
¯¯G H
$str
¯¯I M
,
¯¯M N
$str
¯¯O W
,
¯¯W X

directorId
¯¯Y c
)
¯¯c d
;
¯¯d e
ViewBag
˘˘ 
.
˘˘ 
ActorIds
˘˘ 
=
˘˘ 
new
˘˘ "
MultiSelectList
˘˘# 2
(
˘˘2 3
_context
˘˘3 ;
.
˘˘; <
Actores
˘˘< C
,
˘˘C D
$str
˘˘E I
,
˘˘I J
$str
˘˘K S
,
˘˘S T
actorIds
˘˘U ]
??
˘˘^ `
Array
˘˘a f
.
˘˘f g
Empty
˘˘g l
<
˘˘l m
int
˘˘m p
>
˘˘p q
(
˘˘q r
)
˘˘r s
)
˘˘s t
;
˘˘t u
}
˙˙ 	
private
¸¸ 
bool
¸¸ 
PeliculaExists
¸¸ #
(
¸¸# $
int
¸¸$ '
id
¸¸( *
)
¸¸* +
=>
¸¸, .
_context
¸¸/ 7
.
¸¸7 8
	Peliculas
¸¸8 A
.
¸¸A B
Any
¸¸B E
(
¸¸E F
e
¸¸F G
=>
¸¸H J
e
¸¸K L
.
¸¸L M
Id
¸¸M O
==
¸¸P R
id
¸¸S U
)
¸¸U V
;
¸¸V W
private
˛˛ 
async
˛˛ 
Task
˛˛ 
<
˛˛ 
(
˛˛ 
bool
˛˛  
ok
˛˛! #
,
˛˛# $
string
˛˛% +
?
˛˛+ ,
rutaRelativa
˛˛- 9
,
˛˛9 :
string
˛˛; A
?
˛˛A B
error
˛˛C H
)
˛˛H I
>
˛˛I J
SaveImageAsync
˛˛K Y
(
˛˛Y Z
	IFormFile
˛˛Z c
file
˛˛d h
)
˛˛h i
{
ˇˇ 	
var
ÄÄ 
ext
ÄÄ 
=
ÄÄ 
Path
ÄÄ 
.
ÄÄ 
GetExtension
ÄÄ '
(
ÄÄ' (
file
ÄÄ( ,
.
ÄÄ, -
FileName
ÄÄ- 5
)
ÄÄ5 6
.
ÄÄ6 7
ToLowerInvariant
ÄÄ7 G
(
ÄÄG H
)
ÄÄH I
;
ÄÄI J
if
ÅÅ 
(
ÅÅ 
!
ÅÅ 
_extPermitidas
ÅÅ 
.
ÅÅ  
Contains
ÅÅ  (
(
ÅÅ( )
ext
ÅÅ) ,
)
ÅÅ, -
)
ÅÅ- .
return
ÇÇ 
(
ÇÇ 
false
ÇÇ 
,
ÇÇ 
null
ÇÇ #
,
ÇÇ# $
$"
ÇÇ% '
$str
ÇÇ' D
{
ÇÇD E
string
ÇÇE K
.
ÇÇK L
Join
ÇÇL P
(
ÇÇP Q
$str
ÇÇQ U
,
ÇÇU V
_extPermitidas
ÇÇW e
)
ÇÇe f
}
ÇÇf g
"
ÇÇg h
)
ÇÇh i
;
ÇÇi j
var
ÖÖ 
provider
ÖÖ 
=
ÖÖ 
new
ÖÖ .
 FileExtensionContentTypeProvider
ÖÖ ?
(
ÖÖ? @
)
ÖÖ@ A
;
ÖÖA B
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 
provider
ÜÜ 
.
ÜÜ 
TryGetContentType
ÜÜ +
(
ÜÜ+ ,
file
ÜÜ, 0
.
ÜÜ0 1
FileName
ÜÜ1 9
,
ÜÜ9 :
out
ÜÜ; >
var
ÜÜ? B
contentType
ÜÜC N
)
ÜÜN O
)
ÜÜO P
contentType
áá 
=
áá 
file
áá "
.
áá" #
ContentType
áá# .
;
áá. /
if
ââ 
(
ââ 
string
ââ 
.
ââ 
IsNullOrEmpty
ââ $
(
ââ$ %
contentType
ââ% 0
)
ââ0 1
||
ââ2 4
!
ââ5 6
_mimePermitidos
ââ6 E
.
ââE F
Contains
ââF N
(
ââN O
contentType
ââO Z
.
ââZ [
ToLowerInvariant
ââ[ k
(
ââk l
)
ââl m
)
ââm n
)
âân o
return
ää 
(
ää 
false
ää 
,
ää 
null
ää #
,
ää# $
$str
ää% F
)
ääF G
;
ääG H
var
çç 
webRoot
çç 
=
çç 
_env
çç 
.
çç 
WebRootPath
çç *
??
çç+ -
Path
çç. 2
.
çç2 3
Combine
çç3 :
(
çç: ;
	Directory
çç; D
.
ççD E!
GetCurrentDirectory
ççE X
(
ççX Y
)
ççY Z
,
ççZ [
$str
çç\ e
)
ççe f
;
ççf g
var
éé 

carpetaAbs
éé 
=
éé 
Path
éé !
.
éé! "
Combine
éé" )
(
éé) *
webRoot
éé* 1
,
éé1 2
CarpetaRelativa
éé3 B
)
ééB C
;
ééC D
	Directory
èè 
.
èè 
CreateDirectory
èè %
(
èè% &

carpetaAbs
èè& 0
)
èè0 1
;
èè1 2
var
íí 
nombre
íí 
=
íí 
$"
íí 
{
íí 
Guid
íí  
.
íí  !
NewGuid
íí! (
(
íí( )
)
íí) *
:
íí* +
$str
íí+ ,
}
íí, -
{
íí- .
ext
íí. 1
}
íí1 2
"
íí2 3
;
íí3 4
var
ìì 
rutaAbs
ìì 
=
ìì 
Path
ìì 
.
ìì 
Combine
ìì &
(
ìì& '

carpetaAbs
ìì' 1
,
ìì1 2
nombre
ìì3 9
)
ìì9 :
;
ìì: ;
using
ïï 
(
ïï 
var
ïï 
stream
ïï 
=
ïï 
new
ïï  #

FileStream
ïï$ .
(
ïï. /
rutaAbs
ïï/ 6
,
ïï6 7
FileMode
ïï8 @
.
ïï@ A
Create
ïïA G
)
ïïG H
)
ïïH I
await
ññ 
file
ññ 
.
ññ 
CopyToAsync
ññ &
(
ññ& '
stream
ññ' -
)
ññ- .
;
ññ. /
var
òò 
rutaRel
òò 
=
òò 
Path
òò 
.
òò 
Combine
òò &
(
òò& '
CarpetaRelativa
òò' 6
,
òò6 7
nombre
òò8 >
)
òò> ?
;
òò? @
return
ôô 
(
ôô 
true
ôô 
,
ôô 
rutaRel
ôô !
,
ôô! "
null
ôô# '
)
ôô' (
;
ôô( )
}
öö 	
private
úú 
void
úú !
DeleteImageIfExists
úú (
(
úú( )
string
úú) /
rutaPublica
úú0 ;
)
úú; <
{
ùù 	
var
üü 
webRoot
üü 
=
üü 
_env
üü 
.
üü 
WebRootPath
üü *
??
üü+ -
Path
üü. 2
.
üü2 3
Combine
üü3 :
(
üü: ;
	Directory
üü; D
.
üüD E!
GetCurrentDirectory
üüE X
(
üüX Y
)
üüY Z
,
üüZ [
$str
üü\ e
)
üüe f
;
üüf g
var
†† 
relativa
†† 
=
†† 
rutaPublica
†† &
.
††& '
	TrimStart
††' 0
(
††0 1
$char
††1 4
)
††4 5
.
††5 6
Replace
††6 =
(
††= >
$str
††> A
,
††A B
Path
††C G
.
††G H$
DirectorySeparatorChar
††H ^
.
††^ _
ToString
††_ g
(
††g h
)
††h i
)
††i j
;
††j k
var
°° 
rutaAbs
°° 
=
°° 
Path
°° 
.
°° 
Combine
°° &
(
°°& '
webRoot
°°' .
,
°°. /
relativa
°°0 8
)
°°8 9
;
°°9 :
if
££ 
(
££ 
System
££ 
.
££ 
IO
££ 
.
££ 
File
££ 
.
££ 
Exists
££ %
(
££% &
rutaAbs
££& -
)
££- .
)
££. /
System
§§ 
.
§§ 
IO
§§ 
.
§§ 
File
§§ 
.
§§ 
Delete
§§ %
(
§§% &
rutaAbs
§§& -
)
§§- .
;
§§. /
}
•• 	
}
¶¶ 
}ßß ó
C:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Controllers\HomeController.cs
	namespace 	
CineWeb
 
. 
Controllers 
{ 
public 

class 
HomeController 
:  !

Controller" ,
{ 
private		 
readonly		 
ILogger		  
<		  !
HomeController		! /
>		/ 0
_logger		1 8
;		8 9
public 
HomeController 
( 
ILogger %
<% &
HomeController& 4
>4 5
logger6 <
)< =
{ 	
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
public 
IActionResult 
Privacy $
($ %
)% &
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public 
IActionResult 
Error "
(" #
)# $
{ 	
return 
View 
( 
new 
ErrorViewModel *
{+ ,
	RequestId- 6
=7 8
Activity9 A
.A B
CurrentB I
?I J
.J K
IdK M
??N P
HttpContextQ \
.\ ]
TraceIdentifier] l
}m n
)n o
;o p
} 	
} 
}   ⁄u
ÉC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Controllers\GeneroesController.cs
	namespace 	
CineWeb
 
. 
Controllers 
{ 
public 

class 
GeneroesController #
:$ %

Controller& 0
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
GeneroesController !
(! "
AppDbContext" .
context/ 6
)6 7
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
q6 7
)7 8
{ 	
var 
query 
= 
_context  
.  !
Generos! (
.( )
AsNoTracking) 5
(5 6
)6 7
;7 8
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
q+ ,
), -
)- .
query 
= 
query 
. 
Where #
(# $
g$ %
=>& (
g) *
.* +
Nombre+ 1
.1 2
Contains2 :
(: ;
q; <
)< =
)= >
;> ?
var 
counts 
= 
await 
_context '
.' (
	Peliculas( 1
. 
AsNoTracking 
( 
) 
. 
GroupBy 
( 
p 
=> 
p 
.  
GeneroId  (
)( )
.   
Select   
(   
g   
=>   
new    
{  ! "
GeneroId  # +
=  , -
g  . /
.  / 0
Key  0 3
,  3 4
Cnt  5 8
=  9 :
g  ; <
.  < =
Count  = B
(  B C
)  C D
}  E F
)  F G
.!! 
ToDictionaryAsync!! "
(!!" #
x!!# $
=>!!% '
x!!( )
.!!) *
GeneroId!!* 2
,!!2 3
x!!4 5
=>!!6 8
x!!9 :
.!!: ;
Cnt!!; >
)!!> ?
;!!? @
ViewBag## 
.## 
PeliculasPorGenero## &
=##' (
counts##) /
;##/ 0
var%% 
lista%% 
=%% 
await%% 
query%% #
.&& 
OrderBy&& 
(&& 
g&& 
=>&& 
g&& 
.&&  
Nombre&&  &
)&&& '
.'' 
ToListAsync'' 
('' 
)'' 
;'' 
return)) 
View)) 
()) 
lista)) 
))) 
;)) 
}** 	
public.. 
async.. 
Task.. 
<.. 
IActionResult.. '
>..' (
Details..) 0
(..0 1
int..1 4
?..4 5
id..6 8
)..8 9
{// 	
if00 
(00 
!00 

ModelState00 
.00 
IsValid00 #
)00# $
{11 
return22 

BadRequest22 !
(22! "

ModelState22" ,
)22, -
;22- .
}33 
if44 
(44 
id44 
==44 
null44 
)44 
{55 
return66 
NotFound66 
(66  
)66  !
;66! "
}77 
var99 
genero99 
=99 
await99 
_context99 '
.99' (
Generos99( /
.:: 
Include:: 
(:: 
g:: 
=>:: 
g:: 
.::  
	Peliculas::  )
)::) *
.;; 
ThenInclude;;  
(;;  !
p;;! "
=>;;# %
p;;& '
.;;' (
Director;;( 0
);;0 1
.<< 
FirstOrDefaultAsync<< $
(<<$ %
m<<% &
=><<' )
m<<* +
.<<+ ,
Id<<, .
==<</ 1
id<<2 4
)<<4 5
;<<5 6
if== 
(== 
genero== 
==== 
null== 
)== 
{>> 
return?? 
NotFound?? 
(??  
)??  !
;??! "
}@@ 
returnBB 
ViewBB 
(BB 
generoBB 
)BB 
;BB  
}CC 	
publicEE 
asyncEE 
TaskEE 
<EE 
IActionResultEE '
>EE' (
	PeliculasEE) 2
(EE2 3
intEE3 6
idEE7 9
)EE9 :
{FF 	
ifGG 
(GG 
!GG 

ModelStateGG 
.GG 
IsValidGG #
)GG# $
{HH 
returnII 

BadRequestII !
(II! "

ModelStateII" ,
)II, -
;II- .
}JJ 
varKK 
generoKK 
=KK 
awaitKK 
_contextKK '
.KK' (
GenerosKK( /
.KK/ 0
	FindAsyncKK0 9
(KK9 :
idKK: <
)KK< =
;KK= >
ifLL 
(LL 
generoLL 
==LL 
nullLL 
)LL 
returnLL  &
NotFoundLL' /
(LL/ 0
)LL0 1
;LL1 2
varNN 
pelisNN 
=NN 
awaitNN 
_contextNN &
.NN& '
	PeliculasNN' 0
.OO 
WhereOO 
(OO 
pOO 
=>OO 
pOO 
.OO 
GeneroIdOO &
==OO' )
idOO* ,
)OO, -
.PP 
IncludePP 
(PP 
pPP 
=>PP 
pPP 
.PP  
DirectorPP  (
)PP( )
.QQ 
ToListAsyncQQ 
(QQ 
)QQ 
;QQ 
ViewBagSS 
.SS 
GeneroNombreSS  
=SS! "
generoSS# )
.SS) *
NombreSS* 0
;SS0 1
ViewBagTT 
.TT 
GeneroIdTT 
=TT 
generoTT %
.TT% &
IdTT& (
;TT( )
returnUU 
ViewUU 
(UU 
pelisUU 
)UU 
;UU 
}VV 	
publicYY 
IActionResultYY 
CreateYY #
(YY# $
)YY$ %
{ZZ 	
return[[ 
View[[ 
([[ 
)[[ 
;[[ 
}\\ 	
[aa 	
HttpPostaa	 
]aa 
[bb 	$
ValidateAntiForgeryTokenbb	 !
]bb! "
publiccc 
asynccc 
Taskcc 
<cc 
IActionResultcc '
>cc' (
Createcc) /
(cc/ 0
[cc0 1
Bindcc1 5
(cc5 6
$strcc6 M
)ccM N
]ccN O
GeneroccP V
generoccW ]
)cc] ^
{dd 	
ifee 
(ee 

ModelStateee 
.ee 
IsValidee "
)ee" #
{ff 
_contextgg 
.gg 
Addgg 
(gg 
generogg #
)gg# $
;gg$ %
awaithh 
_contexthh 
.hh 
SaveChangesAsynchh /
(hh/ 0
)hh0 1
;hh1 2
returnii 
RedirectToActionii '
(ii' (
nameofii( .
(ii. /
Indexii/ 4
)ii4 5
)ii5 6
;ii6 7
}jj 
returnkk 
Viewkk 
(kk 
generokk 
)kk 
;kk  
}ll 	
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
Editoo) -
(oo- .
intoo. 1
?oo1 2
idoo3 5
)oo5 6
{pp 	
ifqq 
(qq 
!qq 

ModelStateqq 
.qq 
IsValidqq #
)qq# $
{rr 
returnss 

BadRequestss !
(ss! "

ModelStatess" ,
)ss, -
;ss- .
}tt 
ifuu 
(uu 
iduu 
==uu 
nulluu 
)uu 
{vv 
returnww 
NotFoundww 
(ww  
)ww  !
;ww! "
}xx 
varzz 
generozz 
=zz 
awaitzz 
_contextzz '
.zz' (
Generoszz( /
.zz/ 0
	FindAsynczz0 9
(zz9 :
idzz: <
)zz< =
;zz= >
if{{ 
({{ 
genero{{ 
=={{ 
null{{ 
){{ 
{|| 
return}} 
NotFound}} 
(}}  
)}}  !
;}}! "
}~~ 
return 
View 
( 
genero 
) 
;  
}
ÄÄ 	
[
ÖÖ 	
HttpPost
ÖÖ	 
]
ÖÖ 
[
ÜÜ 	&
ValidateAntiForgeryToken
ÜÜ	 !
]
ÜÜ! "
public
áá 
async
áá 
Task
áá 
<
áá 
IActionResult
áá '
>
áá' (
Edit
áá) -
(
áá- .
int
áá. 1
id
áá2 4
,
áá4 5
[
áá6 7
Bind
áá7 ;
(
áá; <
$str
áá< S
)
ááS T
]
ááT U
Genero
ááV \
genero
áá] c
)
áác d
{
àà 	
if
ää 
(
ää 
id
ää 
!=
ää 
genero
ää 
.
ää 
Id
ää 
)
ää  
{
ãã 
return
åå 
NotFound
åå 
(
åå  
)
åå  !
;
åå! "
}
çç 
if
èè 
(
èè 

ModelState
èè 
.
èè 
IsValid
èè "
)
èè" #
{
êê 
try
ëë 
{
íí 
_context
ìì 
.
ìì 
Update
ìì #
(
ìì# $
genero
ìì$ *
)
ìì* +
;
ìì+ ,
await
îî 
_context
îî "
.
îî" #
SaveChangesAsync
îî# 3
(
îî3 4
)
îî4 5
;
îî5 6
}
ïï 
catch
ññ 
(
ññ *
DbUpdateConcurrencyException
ññ 3
)
ññ3 4
{
óó 
if
òò 
(
òò 
!
òò 
GeneroExists
òò %
(
òò% &
genero
òò& ,
.
òò, -
Id
òò- /
)
òò/ 0
)
òò0 1
{
ôô 
return
öö 
NotFound
öö '
(
öö' (
)
öö( )
;
öö) *
}
õõ 
else
úú 
{
ùù 
throw
ûû 
;
ûû 
}
üü 
}
†† 
return
°° 
RedirectToAction
°° '
(
°°' (
nameof
°°( .
(
°°. /
Index
°°/ 4
)
°°4 5
)
°°5 6
;
°°6 7
}
¢¢ 
return
££ 
View
££ 
(
££ 
genero
££ 
)
££ 
;
££  
}
§§ 	
public
ßß 
async
ßß 
Task
ßß 
<
ßß 
IActionResult
ßß '
>
ßß' (
Delete
ßß) /
(
ßß/ 0
int
ßß0 3
?
ßß3 4
id
ßß5 7
)
ßß7 8
{
®® 	
if
©© 
(
©© 
!
©© 

ModelState
©© 
.
©© 
IsValid
©© #
)
©©# $
{
™™ 
return
´´ 

BadRequest
´´ !
(
´´! "

ModelState
´´" ,
)
´´, -
;
´´- .
}
¨¨ 
if
≠≠ 
(
≠≠ 
id
≠≠ 
==
≠≠ 
null
≠≠ 
)
≠≠ 
{
ÆÆ 
return
ØØ 
NotFound
ØØ 
(
ØØ  
)
ØØ  !
;
ØØ! "
}
∞∞ 
var
≤≤ 
genero
≤≤ 
=
≤≤ 
await
≤≤ 
_context
≤≤ '
.
≤≤' (
Generos
≤≤( /
.
≥≥ !
FirstOrDefaultAsync
≥≥ $
(
≥≥$ %
m
≥≥% &
=>
≥≥' )
m
≥≥* +
.
≥≥+ ,
Id
≥≥, .
==
≥≥/ 1
id
≥≥2 4
)
≥≥4 5
;
≥≥5 6
if
¥¥ 
(
¥¥ 
genero
¥¥ 
==
¥¥ 
null
¥¥ 
)
¥¥ 
{
µµ 
return
∂∂ 
NotFound
∂∂ 
(
∂∂  
)
∂∂  !
;
∂∂! "
}
∑∑ 
return
ππ 
View
ππ 
(
ππ 
genero
ππ 
)
ππ 
;
ππ  
}
∫∫ 	
[
ΩΩ 	
HttpPost
ΩΩ	 
,
ΩΩ 

ActionName
ΩΩ 
(
ΩΩ 
$str
ΩΩ &
)
ΩΩ& '
]
ΩΩ' (
[
ææ 	&
ValidateAntiForgeryToken
ææ	 !
]
ææ! "
public
øø 
async
øø 
Task
øø 
<
øø 
IActionResult
øø '
>
øø' (
DeleteConfirmed
øø) 8
(
øø8 9
int
øø9 <
id
øø= ?
)
øø? @
{
¿¿ 	
if
¡¡ 
(
¡¡ 
!
¡¡ 

ModelState
¡¡ 
.
¡¡ 
IsValid
¡¡ #
)
¡¡# $
{
¬¬ 
return
√√ 

BadRequest
√√ !
(
√√! "

ModelState
√√" ,
)
√√, -
;
√√- .
}
ƒƒ 
var
≈≈ 
genero
≈≈ 
=
≈≈ 
await
≈≈ 
_context
≈≈ '
.
≈≈' (
Generos
≈≈( /
.
≈≈/ 0
	FindAsync
≈≈0 9
(
≈≈9 :
id
≈≈: <
)
≈≈< =
;
≈≈= >
if
∆∆ 
(
∆∆ 
genero
∆∆ 
!=
∆∆ 
null
∆∆ 
)
∆∆ 
{
«« 
_context
»» 
.
»» 
Generos
»»  
.
»»  !
Remove
»»! '
(
»»' (
genero
»»( .
)
»». /
;
»»/ 0
}
…… 
await
ÀÀ 
_context
ÀÀ 
.
ÀÀ 
SaveChangesAsync
ÀÀ +
(
ÀÀ+ ,
)
ÀÀ, -
;
ÀÀ- .
return
ÃÃ 
RedirectToAction
ÃÃ #
(
ÃÃ# $
nameof
ÃÃ$ *
(
ÃÃ* +
Index
ÃÃ+ 0
)
ÃÃ0 1
)
ÃÃ1 2
;
ÃÃ2 3
}
ÕÕ 	
private
œœ 
bool
œœ 
GeneroExists
œœ !
(
œœ! "
int
œœ" %
id
œœ& (
)
œœ( )
{
–– 	
return
—— 
_context
—— 
.
—— 
Generos
—— #
.
——# $
Any
——$ '
(
——' (
e
——( )
=>
——* ,
e
——- .
.
——. /
Id
——/ 1
==
——2 4
id
——5 7
)
——7 8
;
——8 9
}
““ 	
}
”” 
}‘‘ æÉ
ÑC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Controllers\DirectorsController.cs
	namespace 	
CineWeb
 
. 
Controllers 
{ 
public 

class 
DirectorsController $
:% &

Controller' 1
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
DirectorsController "
(" #
AppDbContext# /
context0 7
)7 8
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
IActionResult '
>' (
	Peliculas) 2
(2 3
int3 6
id7 9
,9 :
string; A
?A B
qC D
)D E
{ 	
if 
( 
! 

ModelState 
. 
IsValid #
)# $
{ 
return 

BadRequest !
(! "

ModelState" ,
), -
;- .
} 
var 
director 
= 
await  
_context! )
.) *

Directores* 4
. 
AsNoTracking 
( 
) 
.   
FirstOrDefaultAsync   $
(  $ %
d  % &
=>  ' )
d  * +
.  + ,
Id  , .
==  / 1
id  2 4
)  4 5
;  5 6
if!! 
(!! 
director!! 
==!! 
null!!  
)!!  !
return!!" (
NotFound!!) 1
(!!1 2
)!!2 3
;!!3 4

IQueryable## 
<## 
Pelicula## 
>##  
pelis##! &
=##' (
_context##) 1
.##1 2
	Peliculas##2 ;
.$$ 
AsNoTracking$$ 
($$ 
)$$ 
.%% 
Where%% 
(%% 
p%% 
=>%% 
p%% 
.%% 

DirectorId%% (
==%%) +
id%%, .
)%%. /
;%%/ 0
if'' 
('' 
!'' 
string'' 
.'' 
IsNullOrWhiteSpace'' *
(''* +
q''+ ,
)'', -
)''- .
{(( 
pelis)) 
=)) 
pelis)) 
.)) 
Where)) #
())# $
p))$ %
=>))& (
p))) *
.))* +
Titulo))+ 1
.))1 2
Contains))2 :
()): ;
q)); <
)))< =
)))= >
;))> ?
}** 
pelis++ 
=++ 
pelis++ 
.++ 
Include++ !
(++! "
p++" #
=>++$ &
p++' (
.++( )
Genero++) /
)++/ 0
;++0 1
var-- 
lista-- 
=-- 
await-- 
pelis-- #
... 
OrderByDescending.. "
(.." #
p..# $
=>..% '
p..( )
...) *
FechaEstreno..* 6
)..6 7
.// 
ToListAsync// 
(// 
)// 
;// 
ViewBag11 
.11 
DirectorNombre11 "
=11# $
director11% -
.11- .
Nombre11. 4
;114 5
ViewBag22 
.22 

DirectorId22 
=22  
director22! )
.22) *
Id22* ,
;22, -
ViewData33 
[33 
$str33 
]33 
=33 
q33 
;33 
return55 
View55 
(55 
lista55 
)55 
;55 
}66 	
public;; 
async;; 
Task;; 
<;; 
IActionResult;; '
>;;' (
Index;;) .
(;;. /
string;;/ 5
q;;6 7
);;7 8
{<< 	
var== 
query== 
=== 
_context==  
.==  !

Directores==! +
.==+ ,
AsNoTracking==, 8
(==8 9
)==9 :
;==: ;
if?? 
(?? 
!?? 
string?? 
.?? 
IsNullOrWhiteSpace?? *
(??* +
q??+ ,
)??, -
)??- .
query@@ 
=@@ 
query@@ 
.@@ 
Where@@ #
(@@# $
d@@$ %
=>@@& (
d@@) *
.@@* +
Nombre@@+ 1
.@@1 2
Contains@@2 :
(@@: ;
q@@; <
)@@< =
)@@= >
;@@> ?
varBB 
countsBB 
=BB 
awaitBB 
_contextBB '
.BB' (
	PeliculasBB( 1
.CC 
AsNoTrackingCC 
(CC 
)CC 
.DD 
GroupByDD 
(DD 
pDD 
=>DD 
pDD 
.DD  

DirectorIdDD  *
)DD* +
.EE 
SelectEE 
(EE 
gEE 
=>EE 
newEE  
{EE! "

DirectorIdEE# -
=EE. /
gEE0 1
.EE1 2
KeyEE2 5
,EE5 6
CntEE7 :
=EE; <
gEE= >
.EE> ?
CountEE? D
(EED E
)EEE F
}EEG H
)EEH I
.FF 
ToDictionaryAsyncFF "
(FF" #
xFF# $
=>FF% '
xFF( )
.FF) *

DirectorIdFF* 4
,FF4 5
xFF6 7
=>FF8 :
xFF; <
.FF< =
CntFF= @
)FF@ A
;FFA B
ViewBagHH 
.HH  
PeliculasPorDirectorHH (
=HH) *
countsHH+ 1
;HH1 2
ViewDataII 
[II 
$strII 
]II 
=II 
qII 
;II 
varKK 
listaKK 
=KK 
awaitKK 
queryKK #
.KK# $
OrderByKK$ +
(KK+ ,
dKK, -
=>KK. 0
dKK1 2
.KK2 3
NombreKK3 9
)KK9 :
.KK: ;
ToListAsyncKK; F
(KKF G
)KKG H
;KKH I
returnLL 
ViewLL 
(LL 
listaLL 
)LL 
;LL 
}MM 	
publicPP 
asyncPP 
TaskPP 
<PP 
IActionResultPP '
>PP' (
DetailsPP) 0
(PP0 1
intPP1 4
?PP4 5
idPP6 8
)PP8 9
{QQ 	
ifRR 
(RR 
!RR 

ModelStateRR 
.RR 
IsValidRR #
)RR# $
{SS 
returnTT 

BadRequestTT !
(TT! "

ModelStateTT" ,
)TT, -
;TT- .
}UU 
ifWW 
(WW 
idWW 
==WW 
nullWW 
)WW 
returnWW "
NotFoundWW# +
(WW+ ,
)WW, -
;WW- .
varYY 
directorYY 
=YY 
awaitYY  
_contextYY! )
.YY) *

DirectoresYY* 4
.ZZ 
AsNoTrackingZZ 
(ZZ 
)ZZ 
.[[ 
Include[[ 
([[ 
d[[ 
=>[[ 
d[[ 
.[[  
	Peliculas[[  )
)[[) *
.\\ 
FirstOrDefaultAsync\\ $
(\\$ %
m\\% &
=>\\' )
m\\* +
.\\+ ,
Id\\, .
==\\/ 1
id\\2 4
)\\4 5
;\\5 6
if^^ 
(^^ 
director^^ 
==^^ 
null^^  
)^^  !
return^^" (
NotFound^^) 1
(^^1 2
)^^2 3
;^^3 4
return`` 
View`` 
(`` 
director``  
)``  !
;``! "
}aa 	
publicee 
IActionResultee 
Createee #
(ee# $
)ee$ %
{ff 	
returngg 
Viewgg 
(gg 
)gg 
;gg 
}hh 	
[mm 	
HttpPostmm	 
]mm 
[nn 	$
ValidateAntiForgeryTokennn	 !
]nn! "
publicoo 
asyncoo 
Taskoo 
<oo 
IActionResultoo '
>oo' (
Createoo) /
(oo/ 0
[oo0 1
Bindoo1 5
(oo5 6
$stroo6 ^
)oo^ _
]oo_ `
Directorooa i
directorooj r
)oor s
{pp 	
ifqq 
(qq 

ModelStateqq 
.qq 
IsValidqq "
)qq" #
{rr 
_contextss 
.ss 
Addss 
(ss 
directorss %
)ss% &
;ss& '
awaittt 
_contexttt 
.tt 
SaveChangesAsynctt /
(tt/ 0
)tt0 1
;tt1 2
returnuu 
RedirectToActionuu '
(uu' (
nameofuu( .
(uu. /
Indexuu/ 4
)uu4 5
)uu5 6
;uu6 7
}vv 
returnww 
Viewww 
(ww 
directorww  
)ww  !
;ww! "
}xx 	
public{{ 
async{{ 
Task{{ 
<{{ 
IActionResult{{ '
>{{' (
Edit{{) -
({{- .
int{{. 1
?{{1 2
id{{3 5
){{5 6
{|| 	
if~~ 
(~~ 
!~~ 

ModelState~~ 
.~~ 
IsValid~~ #
)~~# $
{ 
return
ÄÄ 

BadRequest
ÄÄ !
(
ÄÄ! "

ModelState
ÄÄ" ,
)
ÄÄ, -
;
ÄÄ- .
}
ÅÅ 
if
ÉÉ 
(
ÉÉ 
id
ÉÉ 
==
ÉÉ 
null
ÉÉ 
)
ÉÉ 
{
ÑÑ 
return
ÖÖ 
NotFound
ÖÖ 
(
ÖÖ  
)
ÖÖ  !
;
ÖÖ! "
}
ÜÜ 
var
àà 
director
àà 
=
àà 
await
àà  
_context
àà! )
.
àà) *

Directores
àà* 4
.
àà4 5
	FindAsync
àà5 >
(
àà> ?
id
àà? A
)
ààA B
;
ààB C
if
ââ 
(
ââ 
director
ââ 
==
ââ 
null
ââ  
)
ââ  !
{
ää 
return
ãã 
NotFound
ãã 
(
ãã  
)
ãã  !
;
ãã! "
}
åå 
return
çç 
View
çç 
(
çç 
director
çç  
)
çç  !
;
çç! "
}
éé 	
[
ìì 	
HttpPost
ìì	 
]
ìì 
[
îî 	&
ValidateAntiForgeryToken
îî	 !
]
îî! "
public
ïï 
async
ïï 
Task
ïï 
<
ïï 
IActionResult
ïï '
>
ïï' (
Edit
ïï) -
(
ïï- .
int
ïï. 1
id
ïï2 4
,
ïï4 5
[
ïï6 7
Bind
ïï7 ;
(
ïï; <
$str
ïï< d
)
ïïd e
]
ïïe f
Director
ïïg o
director
ïïp x
)
ïïx y
{
ññ 	
if
óó 
(
óó 
!
óó 

ModelState
óó 
.
óó 
IsValid
óó #
)
óó# $
{
òò 
return
ôô 

BadRequest
ôô !
(
ôô! "

ModelState
ôô" ,
)
ôô, -
;
ôô- .
}
öö 
if
úú 
(
úú 
id
úú 
!=
úú 
director
úú 
.
úú 
Id
úú !
)
úú! "
{
ùù 
return
ûû 
NotFound
ûû 
(
ûû  
)
ûû  !
;
ûû! "
}
üü 
if
°° 
(
°° 

ModelState
°° 
.
°° 
IsValid
°° "
)
°°" #
{
¢¢ 
try
££ 
{
§§ 
_context
•• 
.
•• 
Update
•• #
(
••# $
director
••$ ,
)
••, -
;
••- .
await
¶¶ 
_context
¶¶ "
.
¶¶" #
SaveChangesAsync
¶¶# 3
(
¶¶3 4
)
¶¶4 5
;
¶¶5 6
}
ßß 
catch
®® 
(
®® *
DbUpdateConcurrencyException
®® 3
)
®®3 4
{
©© 
if
™™ 
(
™™ 
!
™™ 
DirectorExists
™™ '
(
™™' (
director
™™( 0
.
™™0 1
Id
™™1 3
)
™™3 4
)
™™4 5
{
´´ 
return
¨¨ 
NotFound
¨¨ '
(
¨¨' (
)
¨¨( )
;
¨¨) *
}
≠≠ 
else
ÆÆ 
{
ØØ 
throw
∞∞ 
;
∞∞ 
}
±± 
}
≤≤ 
return
≥≥ 
RedirectToAction
≥≥ '
(
≥≥' (
nameof
≥≥( .
(
≥≥. /
Index
≥≥/ 4
)
≥≥4 5
)
≥≥5 6
;
≥≥6 7
}
¥¥ 
return
µµ 
View
µµ 
(
µµ 
director
µµ  
)
µµ  !
;
µµ! "
}
∂∂ 	
public
ππ 
async
ππ 
Task
ππ 
<
ππ 
IActionResult
ππ '
>
ππ' (
Delete
ππ) /
(
ππ/ 0
int
ππ0 3
?
ππ3 4
id
ππ5 7
)
ππ7 8
{
∫∫ 	
if
ªª 
(
ªª 
!
ªª 

ModelState
ªª 
.
ªª 
IsValid
ªª #
)
ªª# $
{
ºº 
return
ΩΩ 

BadRequest
ΩΩ !
(
ΩΩ! "

ModelState
ΩΩ" ,
)
ΩΩ, -
;
ΩΩ- .
}
ææ 
if
¿¿ 
(
¿¿ 
id
¿¿ 
==
¿¿ 
null
¿¿ 
)
¿¿ 
{
¡¡ 
return
¬¬ 
NotFound
¬¬ 
(
¬¬  
)
¬¬  !
;
¬¬! "
}
√√ 
var
≈≈ 
director
≈≈ 
=
≈≈ 
await
≈≈  
_context
≈≈! )
.
≈≈) *

Directores
≈≈* 4
.
∆∆ !
FirstOrDefaultAsync
∆∆ $
(
∆∆$ %
m
∆∆% &
=>
∆∆' )
m
∆∆* +
.
∆∆+ ,
Id
∆∆, .
==
∆∆/ 1
id
∆∆2 4
)
∆∆4 5
;
∆∆5 6
if
«« 
(
«« 
director
«« 
==
«« 
null
««  
)
««  !
{
»» 
return
…… 
NotFound
…… 
(
……  
)
……  !
;
……! "
}
   
return
ÃÃ 
View
ÃÃ 
(
ÃÃ 
director
ÃÃ  
)
ÃÃ  !
;
ÃÃ! "
}
ÕÕ 	
[
–– 	
HttpPost
––	 
,
–– 

ActionName
–– 
(
–– 
$str
–– &
)
––& '
]
––' (
[
—— 	&
ValidateAntiForgeryToken
——	 !
]
——! "
public
““ 
async
““ 
Task
““ 
<
““ 
IActionResult
““ '
>
““' (
DeleteConfirmed
““) 8
(
““8 9
int
““9 <
id
““= ?
)
““? @
{
”” 	
var
‘‘ 
director
‘‘ 
=
‘‘ 
await
‘‘  
_context
‘‘! )
.
‘‘) *

Directores
‘‘* 4
.
‘‘4 5
	FindAsync
‘‘5 >
(
‘‘> ?
id
‘‘? A
)
‘‘A B
;
‘‘B C
if
’’ 
(
’’ 
!
’’ 

ModelState
’’ 
.
’’ 
IsValid
’’ #
)
’’# $
{
÷÷ 
return
◊◊ 

BadRequest
◊◊ !
(
◊◊! "

ModelState
◊◊" ,
)
◊◊, -
;
◊◊- .
}
ÿÿ 
if
⁄⁄ 
(
⁄⁄ 
director
⁄⁄ 
!=
⁄⁄ 
null
⁄⁄  
)
⁄⁄  !
{
€€ 
_context
‹‹ 
.
‹‹ 

Directores
‹‹ #
.
‹‹# $
Remove
‹‹$ *
(
‹‹* +
director
‹‹+ 3
)
‹‹3 4
;
‹‹4 5
}
›› 
await
ﬂﬂ 
_context
ﬂﬂ 
.
ﬂﬂ 
SaveChangesAsync
ﬂﬂ +
(
ﬂﬂ+ ,
)
ﬂﬂ, -
;
ﬂﬂ- .
return
‡‡ 
RedirectToAction
‡‡ #
(
‡‡# $
nameof
‡‡$ *
(
‡‡* +
Index
‡‡+ 0
)
‡‡0 1
)
‡‡1 2
;
‡‡2 3
}
·· 	
private
„„ 
bool
„„ 
DirectorExists
„„ #
(
„„# $
int
„„$ '
id
„„( *
)
„„* +
{
‰‰ 	
return
ÂÂ 
_context
ÂÂ 
.
ÂÂ 

Directores
ÂÂ &
.
ÂÂ& '
Any
ÂÂ' *
(
ÂÂ* +
e
ÂÂ+ ,
=>
ÂÂ- /
e
ÂÂ0 1
.
ÂÂ1 2
Id
ÂÂ2 4
==
ÂÂ5 7
id
ÂÂ8 :
)
ÂÂ: ;
;
ÂÂ; <
}
ÊÊ 	
}
ÁÁ 
}ËË ãg
ÅC:\Users\USUARIO\Desktop\Full Stack Developer\Proyectos\CineWeb-Proyecto-ASP.NET-Core-MVC\CineWeb\Controllers\ActorsController.cs
	namespace		 	
CineWeb		
 
.		 
Controllers		 
{

 
public 

class 
ActorsController !
:" #

Controller$ .
{ 
private 
readonly 
AppDbContext %
_context& .
;. /
public 
ActorsController 
(  
AppDbContext  ,
context- 4
)4 5
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
IActionResult '
>' (
Index) .
(. /
string/ 5
q6 7
)7 8
{ 	
var 
query 
= 
_context  
.  !
Actores! (
.( )
AsNoTracking) 5
(5 6
)6 7
;7 8
if 
( 
! 
string 
. 
IsNullOrWhiteSpace *
(* +
q+ ,
), -
)- .
query 
= 
query 
. 
Where #
(# $
a$ %
=>& (
a) *
.* +
Nombre+ 1
.1 2
Contains2 :
(: ;
q; <
)< =
)= >
;> ?
var 
counts 
= 
await 
_context '
.' (
Set( +
<+ ,
PeliculaActor, 9
>9 :
(: ;
); <
. 
AsNoTracking 
( 
) 
.   
GroupBy   
(   
pa   
=>   
pa   !
.  ! "
ActorId  " )
)  ) *
.!! 
Select!! 
(!! 
g!! 
=>!! 
new!!  
{!!! "
ActorId!!# *
=!!+ ,
g!!- .
.!!. /
Key!!/ 2
,!!2 3
Cnt!!4 7
=!!8 9
g!!: ;
.!!; <
Count!!< A
(!!A B
)!!B C
}!!D E
)!!E F
."" 
ToDictionaryAsync"" "
(""" #
x""# $
=>""% '
x""( )
."") *
ActorId""* 1
,""1 2
x""3 4
=>""5 7
x""8 9
.""9 :
Cnt"": =
)""= >
;""> ?
ViewBag$$ 
.$$ 
PeliculasPorActor$$ %
=$$& '
counts$$( .
;$$. /
var&& 
lista&& 
=&& 
await&& 
query&& #
.'' 
OrderBy'' 
('' 
a'' 
=>'' 
a'' 
.''  
Nombre''  &
)''& '
.(( 
ToListAsync(( 
((( 
)(( 
;(( 
ViewData** 
[** 
$str** 
]** 
=** 
q** 
;** 
return++ 
View++ 
(++ 
lista++ 
)++ 
;++ 
},, 	
public00 
async00 
Task00 
<00 
IActionResult00 '
>00' (
Details00) 0
(000 1
int001 4
?004 5
id006 8
)008 9
{33 	
if55 
(55 
!55 

ModelState55 
.55 
IsValid55 #
)55# $
{66 
return77 

BadRequest77 !
(77! "

ModelState77" ,
)77, -
;77- .
}88 
if:: 
(:: 
id:: 
==:: 
null:: 
):: 
return:: "
NotFound::# +
(::+ ,
)::, -
;::- .
var<< 
actor<< 
=<< 
await<< 
_context<< &
.<<& '
Actores<<' .
.== 
AsNoTracking== 
(== 
)== 
.>> 
Include>> 
(>> 
a>> 
=>>> 
a>> 
.>>  
	Peliculas>>  )
)>>) *
.?? 
ThenInclude??  
(??  !
pa??! #
=>??$ &
pa??' )
.??) *
Pelicula??* 2
)??2 3
.@@ 
ThenInclude@@ $
(@@$ %
p@@% &
=>@@' )
p@@* +
.@@+ ,
Director@@, 4
)@@4 5
.AA 
FirstOrDefaultAsyncAA $
(AA$ %
mAA% &
=>AA' )
mAA* +
.AA+ ,
IdAA, .
==AA/ 1
idAA2 4
)AA4 5
;AA5 6
ifCC 
(CC 
actorCC 
==CC 
nullCC 
)CC 
returnCC %
NotFoundCC& .
(CC. /
)CC/ 0
;CC0 1
returnEE 
ViewEE 
(EE 
actorEE 
)EE 
;EE 
}FF 	
publicII 
IActionResultII 
CreateII #
(II# $
)II$ %
{JJ 	
returnKK 
ViewKK 
(KK 
)KK 
;KK 
}LL 	
[OO 	
HttpPostOO	 
]OO 
[PP 	$
ValidateAntiForgeryTokenPP	 !
]PP! "
publicQQ 
asyncQQ 
TaskQQ 
<QQ 
IActionResultQQ '
>QQ' (
CreateQQ) /
(QQ/ 0
[QQ0 1
BindQQ1 5
(QQ5 6
$strQQ6 [
)QQ[ \
]QQ\ ]
ActorQQ^ c
actorQQd i
)QQi j
{RR 	
ifSS 
(SS 
!SS 

ModelStateSS 
.SS 
IsValidSS #
)SS# $
{TT 
returnUU 
ViewUU 
(UU 
actorUU !
)UU! "
;UU" #
}VV 
_contextYY 
.YY 
AddYY 
(YY 
actorYY 
)YY 
;YY  
awaitZZ 
_contextZZ 
.ZZ 
SaveChangesAsyncZZ +
(ZZ+ ,
)ZZ, -
;ZZ- .
return[[ 
RedirectToAction[[ #
([[# $
nameof[[$ *
([[* +
Index[[+ 0
)[[0 1
)[[1 2
;[[2 3
}\\ 	
public__ 
async__ 
Task__ 
<__ 
IActionResult__ '
>__' (
Edit__) -
(__- .
int__. 1
?__1 2
id__3 5
)__5 6
{`` 	
ifaa 
(aa 
!aa 

ModelStateaa 
.aa 
IsValidaa #
)aa# $
{bb 
returncc 

BadRequestcc !
(cc! "

ModelStatecc" ,
)cc, -
;cc- .
}dd 
ifff 
(ff 
idff 
==ff 
nullff 
)ff 
returnff "
NotFoundff# +
(ff+ ,
)ff, -
;ff- .
varhh 
actorhh 
=hh 
awaithh 
_contexthh &
.hh& '
Actoreshh' .
.hh. /
	FindAsynchh/ 8
(hh8 9
idhh9 ;
)hh; <
;hh< =
ifii 
(ii 
actorii 
==ii 
nullii 
)ii 
returnii %
NotFoundii& .
(ii. /
)ii/ 0
;ii0 1
returnkk 
Viewkk 
(kk 
actorkk 
)kk 
;kk 
}ll 	
[oo 	
HttpPostoo	 
]oo 
[pp 	$
ValidateAntiForgeryTokenpp	 !
]pp! "
publicqq 
asyncqq 
Taskqq 
<qq 
IActionResultqq '
>qq' (
Editqq) -
(qq- .
intqq. 1
idqq2 4
,qq4 5
[qq6 7
Bindqq7 ;
(qq; <
$strqq< a
)qqa b
]qqb c
Actorqqd i
actorqqj o
)qqo p
{rr 	
ifss 
(ss 
idss 
!=ss 
actorss 
.ss 
Idss 
)ss 
returnss  &
NotFoundss' /
(ss/ 0
)ss0 1
;ss1 2
iftt 
(tt 
!tt 

ModelStatett 
.tt 
IsValidtt #
)tt# $
returntt% +
Viewtt, 0
(tt0 1
actortt1 6
)tt6 7
;tt7 8
tryvv 
{ww 
_contextxx 
.xx 
Updatexx 
(xx  
actorxx  %
)xx% &
;xx& '
awaityy 
_contextyy 
.yy 
SaveChangesAsyncyy /
(yy/ 0
)yy0 1
;yy1 2
}zz 
catch{{ 
({{ (
DbUpdateConcurrencyException{{ /
){{/ 0
{|| 
if}} 
(}} 
!}} 
ActorExists}}  
(}}  !
actor}}! &
.}}& '
Id}}' )
)}}) *
)}}* +
return}}, 2
NotFound}}3 ;
(}}; <
)}}< =
;}}= >
throw~~ 
;~~ 
} 
return
ÄÄ 
RedirectToAction
ÄÄ #
(
ÄÄ# $
nameof
ÄÄ$ *
(
ÄÄ* +
Index
ÄÄ+ 0
)
ÄÄ0 1
)
ÄÄ1 2
;
ÄÄ2 3
}
ÅÅ 	
public
ÑÑ 
async
ÑÑ 
Task
ÑÑ 
<
ÑÑ 
IActionResult
ÑÑ '
>
ÑÑ' (
Delete
ÑÑ) /
(
ÑÑ/ 0
int
ÑÑ0 3
?
ÑÑ3 4
id
ÑÑ5 7
)
ÑÑ7 8
{
ÖÖ 	
if
ÜÜ 
(
ÜÜ 
!
ÜÜ 

ModelState
ÜÜ 
.
ÜÜ 
IsValid
ÜÜ #
)
ÜÜ# $
{
áá 
return
àà 

BadRequest
àà !
(
àà! "

ModelState
àà" ,
)
àà, -
;
àà- .
}
ââ 
if
ãã 
(
ãã 
id
ãã 
==
ãã 
null
ãã 
)
ãã 
return
ãã "
NotFound
ãã# +
(
ãã+ ,
)
ãã, -
;
ãã- .
var
çç 
actor
çç 
=
çç 
await
çç 
_context
çç &
.
çç& '
Actores
çç' .
.
éé 
AsNoTracking
éé 
(
éé 
)
éé 
.
èè !
FirstOrDefaultAsync
èè $
(
èè$ %
m
èè% &
=>
èè' )
m
èè* +
.
èè+ ,
Id
èè, .
==
èè/ 1
id
èè2 4
)
èè4 5
;
èè5 6
if
ëë 
(
ëë 
actor
ëë 
==
ëë 
null
ëë 
)
ëë 
return
ëë %
NotFound
ëë& .
(
ëë. /
)
ëë/ 0
;
ëë0 1
return
ìì 
View
ìì 
(
ìì 
actor
ìì 
)
ìì 
;
ìì 
}
îî 	
[
óó 	
HttpPost
óó	 
,
óó 

ActionName
óó 
(
óó 
$str
óó &
)
óó& '
]
óó' (
[
òò 	&
ValidateAntiForgeryToken
òò	 !
]
òò! "
public
ôô 
async
ôô 
Task
ôô 
<
ôô 
IActionResult
ôô '
>
ôô' (
DeleteConfirmed
ôô) 8
(
ôô8 9
int
ôô9 <
id
ôô= ?
)
ôô? @
{
öö 	
if
õõ 
(
õõ 
!
õõ 

ModelState
õõ 
.
õõ 
IsValid
õõ #
)
õõ# $
{
úú 
return
ùù 

BadRequest
ùù !
(
ùù! "

ModelState
ùù" ,
)
ùù, -
;
ùù- .
}
ûû 
var
üü 
actor
üü 
=
üü 
await
üü 
_context
üü &
.
üü& '
Actores
üü' .
.
üü. /
	FindAsync
üü/ 8
(
üü8 9
id
üü9 ;
)
üü; <
;
üü< =
if
°° 
(
°° 
actor
°° 
!=
°° 
null
°° 
)
°° 
{
¢¢ 
_context
££ 
.
££ 
Actores
££  
.
££  !
Remove
££! '
(
££' (
actor
££( -
)
££- .
;
££. /
await
§§ 
_context
§§ 
.
§§ 
SaveChangesAsync
§§ /
(
§§/ 0
)
§§0 1
;
§§1 2
}
•• 
return
¶¶ 
RedirectToAction
¶¶ #
(
¶¶# $
nameof
¶¶$ *
(
¶¶* +
Index
¶¶+ 0
)
¶¶0 1
)
¶¶1 2
;
¶¶2 3
}
ßß 	
private
©© 
bool
©© 
ActorExists
©©  
(
©©  !
int
©©! $
id
©©% '
)
©©' (
{
™™ 	
return
´´ 
_context
´´ 
.
´´ 
Actores
´´ #
.
´´# $
Any
´´$ '
(
´´' (
e
´´( )
=>
´´* ,
e
´´- .
.
´´. /
Id
´´/ 1
==
´´2 4
id
´´5 7
)
´´7 8
;
´´8 9
}
¨¨ 	
}
≠≠ 
}ÆÆ 